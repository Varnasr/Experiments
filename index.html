<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FWI Task Management & Transition Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --fwi-primary: #0891b2;
            --fwi-secondary: #0e7490;
            --fwi-accent: #06b6d4;
            --fwi-light: #ecfeff;
            --fwi-dark: #164e63;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --neutral: #6b7280;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #1f2937;
            background: linear-gradient(135deg, var(--fwi-light) 0%, #f0f9ff 100%);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--fwi-primary) 0%, var(--fwi-secondary) 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(8, 145, 178, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .instructions {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 4px solid var(--fwi-primary);
        }

        .instructions h2 {
            color: var(--fwi-dark);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .instructions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .instruction-card {
            background: var(--fwi-light);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--fwi-accent);
        }

        .instruction-card h3 {
            color: var(--fwi-dark);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .instruction-card p {
            color: var(--neutral);
            font-size: 0.9rem;
        }

        .tabs {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .tab-nav {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab-btn {
            flex: 1;
            padding: 1rem 2rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--neutral);
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-btn.active {
            color: var(--fwi-primary);
            background: white;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--fwi-primary);
        }

        .tab-btn:hover:not(.active) {
            background: #f1f5f9;
            color: var(--fwi-secondary);
        }

        .tab-content {
            display: none;
            padding: 2rem;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            color: var(--fwi-dark);
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--fwi-light);
        }

        .card-title {
            color: var(--fwi-dark);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .btn {
            background: linear-gradient(135deg, var(--fwi-primary) 0%, var(--fwi-secondary) 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3);
        }

        .btn-secondary {
            background: var(--neutral);
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .position-card {
            background: linear-gradient(135deg, var(--fwi-light) 0%, #f0f9ff 100%);
            border: 2px solid var(--fwi-accent);
            border-radius: 12px;
            padding: 1.5rem;
            transition: transform 0.2s ease;
        }

        .position-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(8, 145, 178, 0.15);
        }

        .position-name {
            font-weight: 600;
            color: var(--fwi-dark);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .risk-indicator {
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .risk-low { background: #d1fae5; color: var(--success); }
        .risk-medium { background: #fed7aa; color: var(--warning); }
        .risk-high { background: #fecaca; color: var(--danger); }

        .role-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
            background: var(--fwi-primary);
            color: white;
        }

        .capabilities {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .capability {
            background: rgba(8, 145, 178, 0.1);
            color: var(--fwi-secondary);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            border: 1px solid rgba(8, 145, 178, 0.2);
        }

        .workload-section {
            margin-top: 1rem;
        }

        .workload-display {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .workload-bar {
            width: 120px;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin-right: 1rem;
            overflow: hidden;
        }

        .workload-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .workload-low { background: var(--success); }
        .workload-medium { background: var(--warning); }
        .workload-high { background: var(--danger); }

        .task-pool {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1rem;
        }

        .task-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .task-card:hover {
            border-color: var(--fwi-accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(8, 145, 178, 0.15);
        }

        .task-card.assigned {
            border-color: var(--success);
            background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
        }

        .task-title {
            font-weight: 600;
            color: var(--fwi-dark);
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .task-category {
            background: var(--fwi-light);
            color: var(--fwi-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .priority-critical { color: #7c2d12; font-weight: 700; }
        .priority-high { color: var(--danger); }
        .priority-medium { color: var(--warning); }
        .priority-low { color: var(--success); }

        .deadline-indicator {
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .deadline-overdue { background: #fecaca; color: var(--danger); }
        .deadline-urgent { background: #fed7aa; color: var(--warning); }
        .deadline-soon { background: #fef3c7; color: #d97706; }
        .deadline-normal { background: var(--fwi-light); color: var(--fwi-primary); }

        .form-section {
            background: #f8fafc;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--fwi-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--fwi-primary);
            box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.1);
        }

        .form-group input[type="range"] {
            accent-color: var(--fwi-primary);
        }

        .decision-matrix {
            background: var(--fwi-light);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--fwi-accent);
        }

        .option-comparison {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            text-align: center;
            transition: all 0.3s ease;
        }

        .option-card.top-ranked {
            border-color: var(--success);
            background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--fwi-primary);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--neutral);
            font-weight: 500;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .tool-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
        }

        .tool-section h3 {
            color: var(--fwi-dark);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tool-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .export-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .export-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .export-checkbox input {
            width: auto;
        }

        .preview-area {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.85rem;
        }

        .progress-tracker {
            background: linear-gradient(135deg, var(--fwi-light) 0%, #f0f9ff 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--fwi-accent);
        }

        .progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .progress-status {
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-complete { background: #d1fae5; color: var(--success); }
        .status-partial { background: #fed7aa; color: var(--warning); }
        .status-pending { background: #fecaca; color: var(--danger); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--fwi-light);
        }

        .modal-header h2 {
            color: var(--fwi-dark);
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--neutral);
            padding: 0.5rem;
        }

        .close-btn:hover {
            color: var(--danger);
        }

        @media (max-width: 768px) {
            .tab-nav {
                flex-direction: column;
            }
            
            .team-grid {
                grid-template-columns: 1fr;
            }
            
            .task-pool {
                grid-template-columns: 1fr;
            }
            
            .option-comparison {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🐟 FWI Task Management & Transition Tool</h1>
        <p>Comprehensive Task Distribution and Organizational Decision Support</p>
    </div>

    <div class="container">
        <!-- Instructions Section -->
        <div class="instructions">
            <h2>📋 How to Use This Tool</h2>
            <p>This tool helps you redistribute tasks when team members leave and evaluate organizational restructuring options. Follow the steps below:</p>
            
            <div class="instructions-grid">
                <div class="instruction-card">
                    <h3>🎯 Step 1: Organizational Decision</h3>
                    <p>Use the "Restructuring Options" tab to evaluate whether to promote internally, hire a new manager, or create a specialized role. Adjust the criteria weights based on your priorities.</p>
                </div>
                
                <div class="instruction-card">
                    <h3>👥 Step 2: Review Team</h3>
                    <p>Check current team capacity and capabilities in the "Team Overview" tab. See workload levels and assess who can take on additional responsibilities.</p>
                </div>
                
                <div class="instruction-card">
                    <h3>📋 Step 3: Assign Tasks</h3>
                    <p>In the "Task Distribution" tab, select which team members should take on specific tasks. The tool shows skill matches and workload impact.</p>
                </div>
                
                <div class="instruction-card">
                    <h3>🛠️ Step 4: Use Tools</h3>
                    <p>Use the "Tools" tab to generate reports, meeting agendas, email templates, and track handover progress. All documents can be customized and exported.</p>
                </div>
            </div>
        </div>

        <!-- Main Tabs -->
        <div class="tabs">
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchTab('overview')">📊 Overview</button>
                <button class="tab-btn" onclick="switchTab('restructuring')">🎯 Restructuring Options</button>
                <button class="tab-btn" onclick="switchTab('team')">👥 Team Overview</button>
                <button class="tab-btn" onclick="switchTab('tasks')">📋 Task Distribution</button>
                <button class="tab-btn" onclick="switchTab('tools')">🛠️ Tools</button>
                <button class="tab-btn" onclick="switchTab('custom')">➕ Add Tasks</button>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <h2 class="section-title">📊 Transition Overview</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalTasks">0</div>
                        <div class="stat-label">Total Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="assignedTasks">0</div>
                        <div class="stat-label">Assigned</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="criticalTasks">0</div>
                        <div class="stat-label">Critical Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="overdueTasks">0</div>
                        <div class="stat-label">Overdue</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">🚨 Critical Analysis</h3>
                        <button class="btn btn-small" onclick="analyzeRisks()">🔄 Refresh Analysis</button>
                    </div>
                    <div id="criticalAnalysis">
                        <!-- Analysis will be populated here -->
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">⏰ Upcoming Deadlines</h3>
                    <div id="timelineDashboard">
                        <!-- Timeline will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Restructuring Options Tab -->
            <div id="restructuring" class="tab-content">
                <h2 class="section-title">🎯 Organizational Restructuring Decision Framework</h2>
                
                <div class="card">
                    <p style="margin-bottom: 1.5rem; color: var(--neutral);">
                        Evaluate different approaches to replacing the departed Program Manager role. Adjust the criteria weights below based on your organization's priorities.
                    </p>
                    
                    <div class="option-comparison">
                        <div class="option-card">
                            <h3>Option 1</h3>
                            <h4>Promote Senior PA</h4>
                            <p>Quick implementation, lower cost</p>
                        </div>
                        <div class="option-card">
                            <h3>Option 2</h3>
                            <h4>Hire New PM</h4>
                            <p>Proven structure, strategic capability</p>
                        </div>
                        <div class="option-card">
                            <h3>Option 3</h3>
                            <h4>Hire Lab Ops Manager</h4>
                            <p>Specialized focus, operational expertise</p>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div>
                            <h3 style="margin-bottom: 1rem; color: var(--fwi-dark);">📊 Decision Criteria Weighting</h3>
                            <div class="form-group">
                                <label>Cost Considerations: <span id="costValue">25%</span></label>
                                <input type="range" id="costWeight" min="0" max="100" value="25" onchange="updateDecisionMatrix()">
                            </div>
                            <div class="form-group">
                                <label>Speed of Implementation: <span id="speedValue">30%</span></label>
                                <input type="range" id="speedWeight" min="0" max="100" value="30" onchange="updateDecisionMatrix()">
                            </div>
                            <div class="form-group">
                                <label>Quality/Capability Match: <span id="qualityValue">35%</span></label>
                                <input type="range" id="qualityWeight" min="0" max="100" value="35" onchange="updateDecisionMatrix()">
                            </div>
                            <div class="form-group">
                                <label>Long-term Sustainability: <span id="sustainabilityValue">10%</span></label>
                                <input type="range" id="sustainabilityWeight" min="0" max="100" value="10" onchange="updateDecisionMatrix()">
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="margin-bottom: 1rem; color: var(--fwi-dark);">⚖️ Recommendation Results</h3>
                            <div class="decision-matrix" id="decisionMatrix">
                                <!-- Decision matrix will be populated here -->
                            </div>
                            <button class="btn" onclick="showDetailedAnalysis()" style="margin-top: 1rem;">
                                📋 Show Detailed Analysis
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Team Overview Tab -->
            <div id="team" class="tab-content">
                <h2 class="section-title">👥 Team Positions & Availability</h2>
                
                <div class="team-grid" id="teamPositions">
                    <!-- Team positions will be populated here -->
                </div>
            </div>

            <!-- Task Distribution Tab -->
            <div id="tasks" class="tab-content">
                <h2 class="section-title">📋 Available Tasks for Redistribution</h2>
                
                <p style="margin-bottom: 1.5rem; color: var(--neutral);">
                    Tasks from the departed Program Manager's responsibilities that need redistribution. 
                    <strong style="color: var(--danger);">Priority:</strong> Outcome evaluation tasks must be covered immediately.
                </p>
                
                <div class="task-pool" id="taskPool">
                    <!-- Tasks will be populated here -->
                </div>
            </div>

            <!-- Tools Tab -->
            <div id="tools" class="tab-content">
                <h2 class="section-title">🛠️ Export Tools & Communication</h2>
                
                <div class="tools-grid">
                    <!-- Export Tools -->
                    <div class="tool-section">
                        <h3>📊 Data Export</h3>
                        <div class="export-options">
                            <div class="export-checkbox">
                                <input type="checkbox" id="includeTeam" checked>
                                <label for="includeTeam">Include Team Data</label>
                            </div>
                            <div class="export-checkbox">
                                <input type="checkbox" id="includeTasks" checked>
                                <label for="includeTasks">Include Task Details</label>
                            </div>
                            <div class="export-checkbox">
                                <input type="checkbox" id="includeRisks" checked>
                                <label for="includeRisks">Include Risk Analysis</label>
                            </div>
                            <div class="export-checkbox">
                                <input type="checkbox" id="includeTimeline" checked>
                                <label for="includeTimeline">Include Timeline</label>
                            </div>
                        </div>
                        <div class="tool-buttons">
                            <button class="btn" onclick="exportToPDF()">📄 Export PDF Report</button>
                            <button class="btn" onclick="exportToCSV()">📊 Export Task CSV</button>
                            <button class="btn btn-secondary" onclick="previewExport()">👁️ Preview Export</button>
                        </div>
                        <div id="exportPreview" class="preview-area" style="display: none;">
                            <!-- Export preview will appear here -->
                        </div>
                    </div>

                    <!-- Communication Tools -->
                    <div class="tool-section">
                        <h3>📧 Communication Tools</h3>
                        <div class="tool-buttons">
                            <button class="btn" onclick="generateAgenda()">📋 Meeting Agenda</button>
                            <button class="btn" onclick="generateEmails()">📧 Email Templates</button>
                            <button class="btn" onclick="generateAnnouncement()">📢 Team Announcement</button>
                            <button class="btn btn-secondary" onclick="generateSlackUpdate()">💬 Slack Update</button>
                        </div>
                    </div>

                    <!-- Handover Tools -->
                    <div class="tool-section">
                        <h3>✅ Handover Management</h3>
                        <div class="tool-buttons">
                            <button class="btn" onclick="showHandoverChecklist()">✅ Handover Checklist</button>
                            <button class="btn" onclick="generateKnowledgeTransfer()">📚 Knowledge Transfer Guide</button>
                            <button class="btn" onclick="createTransitionPlan()">📅 Transition Timeline</button>
                            <button class="btn btn-secondary" onclick="generateSOPs()">📋 SOPs & Procedures</button>
                        </div>
                    </div>

                    <!-- Progress Tracking -->
                    <div class="tool-section">
                        <h3>📈 Progress Tracking</h3>
                        <div class="progress-tracker">
                            <div id="progressTracking">
                                <!-- Progress tracking will be populated here -->
                            </div>
                        </div>
                        <div class="tool-buttons" style="margin-top: 1rem;">
                            <button class="btn" onclick="updateProgress()">🔄 Update Progress</button>
                            <button class="btn btn-secondary" onclick="generateProgressReport()">📊 Progress Report</button>
                        </div>
                    </div>

                    <!-- Risk Assessment -->
                    <div class="tool-section">
                        <h3>⚠️ Risk Management</h3>
                        <div class="tool-buttons">
                            <button class="btn" onclick="generateRiskAssessment()">⚠️ Risk Assessment</button>
                            <button class="btn" onclick="createContingencyPlan()">🛡️ Contingency Plan</button>
                            <button class="btn btn-secondary" onclick="scheduleCheckIns()">📅 Schedule Check-ins</button>
                        </div>
                    </div>

                    <!-- Document Templates -->
                    <div class="tool-section">
                        <h3>📄 Document Templates</h3>
                        <div class="tool-buttons">
                            <button class="btn" onclick="generateJobDescription()">👔 Job Description</button>
                            <button class="btn" onclick="generateTrainingPlan()">🎓 Training Plan</button>
                            <button class="btn" onclick="generatePerformanceMetrics()">📊 Performance Metrics</button>
                            <button class="btn btn-secondary" onclick="customTemplate()">✏️ Custom Template</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Custom Tasks Tab -->
            <div id="custom" class="tab-content">
                <h2 class="section-title">➕ Add Custom Task</h2>
                
                <div class="form-section">
                    <form id="customTaskForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="taskTitle">Task Description</label>
                                <input type="text" id="taskTitle" placeholder="Describe the specific task..." required>
                            </div>
                            <div class="form-group">
                                <label for="taskCategory">Category</label>
                                <select id="taskCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="outcome-evaluation">Outcome Evaluation Study</option>
                                    <option value="lab-operations">Lab Operations & Quality Control</option>
                                    <option value="field-research">Field Research & Data Collection</option>
                                    <option value="farmer-engagement">Farmer Relationship Management</option>
                                    <option value="equipment-management">Equipment & Resource Management</option>
                                    <option value="strategic-planning">Strategic Planning & Analysis</option>
                                    <option value="protocol-compliance">Protocol Compliance & Training</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="taskPriority">Priority</label>
                                <select id="taskPriority" required>
                                    <option value="critical">Critical</option>
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="taskComplexity">Complexity</label>
                                <select id="taskComplexity" required>
                                    <option value="1">Low (1)</option>
                                    <option value="2">Medium (2)</option>
                                    <option value="3">High (3)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="taskDueDate">Due Date</label>
                                <input type="date" id="taskDueDate" required>
                            </div>
                            <div class="form-group">
                                <label for="taskEstimatedHours">Est. Hours</label>
                                <input type="number" id="taskEstimatedHours" min="1" max="40" placeholder="8">
                            </div>
                            <div class="form-group">
                                <label for="taskCritical">Critical Path</label>
                                <select id="taskCritical">
                                    <option value="false">No</option>
                                    <option value="true">Yes - Critical</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="taskNotes">Additional Notes & Contacts</label>
                                <input type="text" id="taskNotes" placeholder="Requirements, skills needed, key contacts...">
                            </div>
                        </div>
                        <button type="submit" class="btn" style="margin-top: 1rem;">Add Custom Task</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="recommendationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🎯 Smart Assignment Recommendations</h2>
                <button class="close-btn" onclick="closeModal('recommendationsModal')">&times;</button>
            </div>
            <div id="recommendationsContent"></div>
        </div>
    </div>

    <div id="agendaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📋 Meeting Agenda Generator</h2>
                <button class="close-btn" onclick="closeModal('agendaModal')">&times;</button>
            </div>
            <div id="agendaContent"></div>
        </div>
    </div>

    <div id="emailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📧 Communication Templates</h2>
                <button class="close-btn" onclick="closeModal('emailModal')">&times;</button>
            </div>
            <div id="emailContent"></div>
        </div>
    </div>

    <div id="handoverModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>✅ Handover Checklist</h2>
                <button class="close-btn" onclick="closeModal('handoverModal')">&times;</button>
            </div>
            <div id="handoverContent"></div>
        </div>
    </div>

    <div id="templateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="templateModalTitle">📄 Document Template</h2>
                <button class="close-btn" onclick="closeModal('templateModal')">&times;</button>
            </div>
            <div id="templateContent"></div>
        </div>
    </div>

    <script>
        class TaskManager {
            constructor() {
                this.positions = [
                    {
                        id: 'current_manager',
                        title: "Current Programme Manager",
                        role: "manager",
                        capabilities: ["Strategic Planning", "Team Management", "Research Coordination", "Stakeholder Relations", "Data Analysis"],
                        currentWorkload: 85,
                        selectedTasks: [],
                        maxComplexity: 15,
                        riskLevel: 'high'
                    },
                    {
                        id: 'senior_pa',
                        title: "Senior Program Associate (promotion candidate)",
                        role: "spa",
                        capabilities: ["Lab Operations", "Equipment Calibration", "Data Collection", "Pond Management", "Small-scale Experiments"],
                        currentWorkload: 70,
                        selectedTasks: [],
                        maxComplexity: 12,
                        riskLevel: 'medium'
                    },
                    {
                        id: 'pa_eluru',
                        title: "Program Associate - Eluru Region",
                        role: "pa",
                        capabilities: ["Field Work", "Farmer Relations", "Data Collection", "Water Quality Testing", "Equipment Use"],
                        currentWorkload: 65,
                        selectedTasks: [],
                        maxComplexity: 10,
                        riskLevel: 'low'
                    },
                    {
                        id: 'pa_nellore',
                        title: "Program Associate - Nellore Region",
                        role: "pa",
                        capabilities: ["Field Work", "Farmer Relations", "Data Collection", "Water Quality Testing", "Equipment Use"],
                        currentWorkload: 60,
                        selectedTasks: [],
                        maxComplexity: 10,
                        riskLevel: 'low'
                    },
                    {
                        id: 'expros_associate',
                        title: "ExPros Associate (Supporting Outcome Evaluation)",
                        role: "external",
                        capabilities: ["Research Support", "Data Collection", "Protocol Implementation"],
                        currentWorkload: 40,
                        selectedTasks: [],
                        maxComplexity: 8,
                        riskLevel: 'low'
                    },
                    {
                        id: 'rd_support',
                        title: "R&D Staff (Available for Short-term Support)",
                        role: "support",
                        capabilities: ["Technical Analysis", "Research Design", "Data Analysis", "Strategic Input"],
                        currentWorkload: 90,
                        selectedTasks: [],
                        maxComplexity: 14,
                        riskLevel: 'medium'
                    }
                ];

                this.predefinedTasks = [
                    {
                        id: 'protocol-refresher-expros',
                        title: "Refresher of protocols for ExPros associate",
                        category: "outcome-evaluation",
                        priority: "critical",
                        complexity: 2,
                        dueDate: "2025-07-28",
                        estimatedHours: 8,
                        critical: true,
                        status: "in-progress",
                        description: "Essential for outcome evaluation study. Current manager already doing this.",
                        contacts: "ExPros associate, Current programme manager"
                    },
                    {
                        id: 'staff-shadowing-regular',
                        title: "Staff shadowing at control farms - Regular measurements (4 days total)",
                        category: "outcome-evaluation",
                        priority: "critical",
                        complexity: 3,
                        dueDate: "2025-08-05",
                        estimatedHours: 32,
                        critical: true,
                        status: "not-started",
                        description: "2 days per PA for regular measurements. Critical for evaluation study quality control.",
                        contacts: "Program Associates (Eluru & Nellore), Control farm list"
                    },
                    {
                        id: 'staff-shadowing-followup',
                        title: "Staff shadowing at control farms - Follow-up measurements (4 days total)",
                        category: "outcome-evaluation",
                        priority: "critical",
                        complexity: 3,
                        dueDate: "2025-08-12",
                        estimatedHours: 32,
                        critical: true,
                        status: "not-started",
                        description: "2 days per PA for follow-up measurements. Critical for evaluation study quality control.",
                        contacts: "Program Associates (Eluru & Nellore), Control farm list"
                    },
                    {
                        id: 'farmer-compliance-shadowing',
                        title: "Farmer compliance shadowing during corrective actions (25% treatment farms)",
                        category: "outcome-evaluation",
                        priority: "critical",
                        complexity: 3,
                        dueDate: "2025-08-15",
                        estimatedHours: 24,
                        critical: true,
                        status: "not-started",
                        description: "Monitor corrective action implementation in 25% of treatment farms. Critical for study validity.",
                        contacts: "Treatment farm list, Field coordinators"
                    },
                    {
                        id: 'lab-calibration-weekly',
                        title: "Weekly equipment calibration and reagent restocking",
                        category: "lab-operations",
                        priority: "medium",
                        complexity: 2,
                        dueDate: "2025-08-01",
                        estimatedHours: 6,
                        critical: false,
                        status: "not-started",
                        description: "Maintain lab equipment calibration per protocols. Regular PM responsibility.",
                        contacts: "Lab equipment manual, Calibration log"
                    },
                    {
                        id: 'eluru-pa-management',
                        title: "Management and coordination of Eluru Program Associates",
                        category: "field-research",
                        priority: "high",
                        complexity: 2,
                        dueDate: "2025-07-30",
                        estimatedHours: 20,
                        critical: false,
                        status: "not-started",
                        description: "Direct management of Eluru PA and coordination with field activities.",
                        contacts: "Eluru Program Associate, Eluru farmer list"
                    },
                    {
                        id: 'farmer-relationship-visits',
                        title: "Regular farmer relationship building visits",
                        category: "farmer-engagement",
                        priority: "medium",
                        complexity: 2,
                        dueDate: "2025-08-05",
                        estimatedHours: 16,
                        critical: false,
                        status: "not-started",
                        description: "Strengthen farmer relationships and address concerns. Area for improvement.",
                        contacts: "Farmer database, Regional coordinators"
                    },
                    {
                        id: 'pond-addition-processing',
                        title: "Process new pond commitments and farmer forms",
                        category: "farmer-engagement",
                        priority: "medium",
                        complexity: 1,
                        dueDate: "2025-08-02",
                        estimatedHours: 8,
                        critical: false,
                        status: "not-started",
                        description: "Review and process new farmer applications for pond additions.",
                        contacts: "Application forms, Legal requirements checklist"
                    }
                ];

                this.organizationalOptions = [
                    {
                        id: 'promote_senior_pa',
                        name: 'Promote Senior PA to Management Role',
                        cost: 8,
                        speed: 9,
                        quality: 6,
                        sustainability: 5,
                        pros: ['Quick implementation', 'Knows existing systems', 'Lower cost', 'Reduces flight risk'],
                        cons: ['Hierarchy concerns', 'Trust issues observed', 'May not fill strategic gap', 'Limited management experience'],
                        riskFactors: ['Flight risk if not promoted', 'Team dynamics disruption', 'Capability gaps in strategic thinking']
                    },
                    {
                        id: 'hire_pm',
                        name: 'Hire New Program Manager',
                        cost: 4,
                        speed: 3,
                        quality: 8,
                        sustainability: 8,
                        pros: ['Proven structure', 'Can fill strategic gaps', 'Fresh perspective', 'Positions for scaling'],
                        cons: ['Difficult to find candidates', 'Longer implementation time', 'Higher cost', 'Learning curve'],
                        riskFactors: ['Hiring difficulties', 'Cultural fit challenges', 'Extended vacancy period']
                    },
                    {
                        id: 'hire_lab_ops',
                        name: 'Hire Lab Operations Manager',
                        cost: 5,
                        speed: 4,
                        quality: 7,
                        sustainability: 7,
                        pros: ['Fills key operational gaps', 'More field engagement', 'Specialized focus', 'May be easier to hire'],
                        cons: ['Limited strategic input', 'Unclear if role exists in market', 'May still need strategic support'],
                        riskFactors: ['Role definition challenges', 'Market availability uncertain', 'Scope creep potential']
                    }
                ];

                this.customTasks = [];
                this.handoverProgress = {
                    knowledgeTransfer: 'partial',
                    systemAccess: 'pending',
                    taskAssignment: 'partial',
                    documentHandover: 'pending',
                    stakeholderNotification: 'pending'
                };

                this.initializeEventListeners();
                this.setDefaultDueDate();
                this.renderAll();
                this.updateProgressTracking();
            }

            initializeEventListeners() {
                document.getElementById('customTaskForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addCustomTask();
                });
            }

            setDefaultDueDate() {
                const oneWeekFromNow = new Date();
                oneWeekFromNow.setDate(oneWeekFromNow.getDate() + 7);
                const defaultDate = oneWeekFromNow.toISOString().split('T')[0];
                document.getElementById('taskDueDate').value = defaultDate;
            }

            addCustomTask() {
                const task = {
                    id: 'custom-' + Date.now(),
                    title: document.getElementById('taskTitle').value,
                    category: document.getElementById('taskCategory').value,
                    priority: document.getElementById('taskPriority').value,
                    complexity: parseInt(document.getElementById('taskComplexity').value),
                    dueDate: document.getElementById('taskDueDate').value,
                    estimatedHours: parseInt(document.getElementById('taskEstimatedHours').value) || 4,
                    critical: document.getElementById('taskCritical').value === 'true',
                    status: "not-started",
                    description: document.getElementById('taskNotes').value || "Custom task",
                    contacts: "Contact info to be added",
                    custom: true
                };

                this.customTasks.push(task);
                this.renderAll();
                document.getElementById('customTaskForm').reset();
                this.setDefaultDueDate();
            }

            getAllTasks() {
                return [...this.predefinedTasks, ...this.customTasks];
            }

            getDaysUntilDue(dueDate) {
                const today = new Date();
                const due = new Date(dueDate);
                const diffTime = due - today;
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            }

            getDeadlineStatus(dueDate) {
                const days = this.getDaysUntilDue(dueDate);
                if (days < 0) return 'overdue';
                if (days <= 2) return 'urgent';
                if (days <= 7) return 'soon';
                return 'normal';
            }

            getDeadlineText(dueDate) {
                const days = this.getDaysUntilDue(dueDate);
                if (days < 0) return `${Math.abs(days)} days overdue`;
                if (days === 0) return 'Due today';
                if (days === 1) return 'Due tomorrow';
                return `${days} days left`;
            }

            calculateWorkload(position) {
                const taskComplexity = position.selectedTasks.reduce((sum, taskId) => {
                    const task = this.getAllTasks().find(t => t.id === taskId);
                    return sum + (task ? task.complexity : 0);
                }, 0);
                
                const baseWorkload = position.currentWorkload || 0;
                const additionalWorkload = (taskComplexity / position.maxComplexity) * 100;
                
                return Math.min(baseWorkload + additionalWorkload, 100);
            }

            getWorkloadClass(percentage) {
                if (percentage <= 50) return 'workload-low';
                if (percentage <= 80) return 'workload-medium';
                return 'workload-high';
            }

            toggleTaskAssignment(taskId, positionId) {
                // Remove task from all positions first
                this.positions.forEach(pos => {
                    pos.selectedTasks = pos.selectedTasks.filter(id => id !== taskId);
                });
                
                // Add to selected position if provided
                if (positionId) {
                    const position = this.positions.find(p => p.id === positionId);
                    if (position) {
                        position.selectedTasks.push(taskId);
                    }
                }
                
                this.renderAll();
            }

            updateDecisionMatrix() {
                const costWeight = document.getElementById('costWeight').value / 100;
                const speedWeight = document.getElementById('speedWeight').value / 100;
                const qualityWeight = document.getElementById('qualityWeight').value / 100;
                const sustainabilityWeight = document.getElementById('sustainabilityWeight').value / 100;
                
                document.getElementById('costValue').textContent = document.getElementById('costWeight').value + '%';
                document.getElementById('speedValue').textContent = document.getElementById('speedWeight').value + '%';
                document.getElementById('qualityValue').textContent = document.getElementById('qualityWeight').value + '%';
                document.getElementById('sustainabilityValue').textContent = document.getElementById('sustainabilityWeight').value + '%';
                
                const scores = this.organizationalOptions.map(option => {
                    const score = (
                        ((10 - option.cost) / 10 * costWeight) +
                        (option.speed / 10 * speedWeight) +
                        (option.quality / 10 * qualityWeight) +
                        (option.sustainability / 10 * sustainabilityWeight)
                    ) * 100;
                    
                    return {
                        ...option,
                        weightedScore: Math.round(score)
                    };
                }).sort((a, b) => b.weightedScore - a.weightedScore);
                
                const matrixHtml = `
                    <h4 style="margin-bottom: 1rem; color: var(--fwi-dark);">Ranked Options:</h4>
                    ${scores.map((option, index) => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: ${index === 0 ? '#d1fae5' : index === 1 ? '#fef3c7' : '#fecaca'}; border-radius: 8px; margin-bottom: 0.5rem;">
                            <span style="font-weight: 600; color: var(--fwi-dark);">${index + 1}. ${option.name}</span>
                            <span style="font-weight: 700; font-size: 1.1rem; color: ${index === 0 ? 'var(--success)' : index === 1 ? 'var(--warning)' : 'var(--danger)'};">${option.weightedScore}%</span>
                        </div>
                    `).join('')}
                `;
                
                document.getElementById('decisionMatrix').innerHTML = matrixHtml;
            }

            analyzeRisks() {
                const allTasks = this.getAllTasks();
                const unassignedTasks = allTasks.filter(task => 
                    !this.positions.some(p => p.selectedTasks.includes(task.id))
                );

                this.positions.forEach(position => {
                    const workload = this.calculateWorkload(position);
                    const overdueTasks = position.selectedTasks.filter(taskId => {
                        const task = allTasks.find(t => t.id === taskId);
                        return task && this.getDeadlineStatus(task.dueDate) === 'overdue';
                    }).length;

                    if (workload > 85 || overdueTasks > 0) {
                        position.riskLevel = 'high';
                    } else if (workload > 65 || position.selectedTasks.length > 4) {
                        position.riskLevel = 'medium';
                    } else {
                        position.riskLevel = 'low';
                    }
                });

                this.renderCriticalAnalysis();
            }

            renderCriticalAnalysis() {
                const allTasks = this.getAllTasks();
                const unassignedTasks = allTasks.filter(task => 
                    !this.positions.some(p => p.selectedTasks.includes(task.id))
                );
                const criticalTasks = allTasks.filter(task => task.critical);
                const unassignedCritical = criticalTasks.filter(task => 
                    !this.positions.some(p => p.selectedTasks.includes(task.id))
                );
                const highRiskPositions = this.positions.filter(p => p.riskLevel === 'high');
                
                let html = '';
                
                if (unassignedCritical.length > 0) {
                    html += `
                        <div style="background: #fef2f2; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--danger); margin-bottom: 1rem;">
                            <h4 style="color: var(--danger); margin-bottom: 0.5rem;">🚨 Unassigned Critical Tasks</h4>
                            ${unassignedCritical.slice(0, 3).map(task => 
                                `<div style="margin-bottom: 0.25rem;">
                                    ${task.title} - Due ${this.getDeadlineText(task.dueDate)}
                                </div>`
                            ).join('')}
                        </div>
                    `;
                }

                if (highRiskPositions.length > 0) {
                    html += `
                        <div style="background: #fff7ed; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--warning); margin-bottom: 1rem;">
                            <h4 style="color: var(--warning); margin-bottom: 0.5rem;">⚠️ Overloaded Positions</h4>
                            ${highRiskPositions.map(pos => 
                                `<div style="margin-bottom: 0.25rem;">
                                    ${pos.title} - ${Math.round(this.calculateWorkload(pos))}% capacity
                                </div>`
                            ).join('')}
                        </div>
                    `;
                }

                if (html === '') {
                    html = '<div style="color: var(--success); text-align: center; padding: 2rem; font-size: 1.1rem;">✅ No critical issues detected</div>';
                }

                document.getElementById('criticalAnalysis').innerHTML = html;
            }

            renderPositions() {
                const container = document.getElementById('teamPositions');
                
                container.innerHTML = this.positions.map(position => {
                    const workload = this.calculateWorkload(position);
                    
                    return `
                        <div class="position-card">
                            <div class="position-name">
                                ${position.title}
                                <span class="risk-indicator risk-${position.riskLevel}">
                                    ${position.riskLevel.toUpperCase()}
                                </span>
                            </div>
                            <span class="role-badge">${position.role.toUpperCase()}</span>
                            
                            <div class="capabilities">
                                ${position.capabilities.map(cap => 
                                    `<span class="capability">${cap}</span>`
                                ).join('')}
                            </div>
                            
                            <div class="workload-section">
                                <div class="workload-display">
                                    <div class="workload-bar">
                                        <div class="workload-fill ${this.getWorkloadClass(workload)}" 
                                             style="width: ${workload}%"></div>
                                    </div>
                                    <span style="font-weight: 600;">
                                        ${Math.round(workload)}% capacity
                                    </span>
                                </div>
                                
                                <div style="margin-top: 1rem;">
                                    <strong>Assigned Tasks (${position.selectedTasks.length}):</strong>
                                    ${position.selectedTasks.length === 0 ? 
                                        '<div style="color: var(--neutral); font-style: italic;">No tasks assigned</div>' :
                                        position.selectedTasks.map(taskId => {
                                            const task = this.getAllTasks().find(t => t.id === taskId);
                                            return task ? `<div style="margin: 0.25rem 0;">• ${task.title}</div>` : '';
                                        }).join('')
                                    }
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderTaskPool() {
                const container = document.getElementById('taskPool');
                const allTasks = this.getAllTasks().sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                
                container.innerHTML = allTasks.map(task => {
                    const deadlineStatus = this.getDeadlineStatus(task.dueDate);
                    const deadlineText = this.getDeadlineText(task.dueDate);
                    const assignedPosition = this.positions.find(p => p.selectedTasks.includes(task.id));
                    
                    return `
                        <div class="task-card ${assignedPosition ? 'assigned' : ''}" onclick="showTaskAssignmentModal('${task.id}')">
                            <div class="task-title">
                                ${task.title}
                                ${task.critical ? '<span style="color: var(--danger);">🚨</span>' : ''}
                            </div>
                            
                            <div class="task-meta">
                                <span class="task-category">${task.category.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</span>
                                <span class="priority-${task.priority}">${task.priority.toUpperCase()}</span>
                            </div>
                            
                            <p style="color: var(--neutral); margin-bottom: 1rem; font-size: 0.9rem;">
                                ${task.description}
                            </p>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <span style="font-size: 0.8rem; color: var(--neutral);">
                                        ${task.estimatedHours}h • Complexity: ${task.complexity}
                                    </span>
                                </div>
                                <span class="deadline-indicator deadline-${deadlineStatus}">
                                    📅 ${deadlineText}
                                </span>
                            </div>
                            
                            ${assignedPosition ? `
                                <div style="margin-top: 1rem; padding: 0.75rem; background: var(--fwi-light); border-radius: 8px; color: var(--fwi-dark);">
                                    ✅ Assigned to: <strong>${assignedPosition.title}</strong>
                                </div>
                            ` : `
                                <div style="margin-top: 1rem; padding: 0.75rem; background: #fef2f2; border-radius: 8px; color: var(--danger);">
                                    ⚠️ Unassigned - Click to assign
                                </div>
                            `}
                        </div>
                    `;
                }).join('');
            }

            renderStats() {
                const allTasks = this.getAllTasks();
                const assignedTasks = allTasks.filter(task => 
                    this.positions.some(p => p.selectedTasks.includes(task.id))
                );
                const criticalTasks = allTasks.filter(task => task.critical);
                const overdueTasks = allTasks.filter(task => 
                    this.getDeadlineStatus(task.dueDate) === 'overdue'
                );
                
                document.getElementById('totalTasks').textContent = allTasks.length;
                document.getElementById('assignedTasks').textContent = assignedTasks.length;
                document.getElementById('criticalTasks').textContent = criticalTasks.length;
                document.getElementById('overdueTasks').textContent = overdueTasks.length;
            }

            renderTimeline() {
                const container = document.getElementById('timelineDashboard');
                const allTasks = this.getAllTasks().sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                const urgentTasks = allTasks.filter(task => {
                    const status = this.getDeadlineStatus(task.dueDate);
                    return status === 'overdue' || status === 'urgent' || status === 'soon';
                }).slice(0, 5);

                if (urgentTasks.length === 0) {
                    container.innerHTML = '<div style="color: var(--neutral); text-align: center; padding: 2rem;">No urgent deadlines</div>';
                    return;
                }

                container.innerHTML = urgentTasks.map(task => {
                    const deadlineStatus = this.getDeadlineStatus(task.dueDate);
                    const deadlineText = this.getDeadlineText(task.dueDate);
                    const isAssigned = this.positions.some(p => p.selectedTasks.includes(task.id));
                    
                    return `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; margin-bottom: 0.5rem; background: white; border-radius: 8px; border-left: 4px solid ${deadlineStatus === 'overdue' ? 'var(--danger)' : deadlineStatus === 'urgent' ? 'var(--warning)' : 'var(--fwi-primary)'};">
                            <div>
                                <strong>${task.title}</strong>
                                ${task.critical ? ' 🚨' : ''}
                                <div style="font-size: 0.8rem; color: var(--neutral);">
                                    ${deadlineText}
                                </div>
                            </div>
                            <div>
                                ${isAssigned ? 
                                    '<span style="color: var(--success); font-weight: 600;">✓ Assigned</span>' : 
                                    '<span style="color: var(--danger); font-weight: 600;">⚠ Unassigned</span>'
                                }
                            </div>
                        </div>
                    `;
                }).join('');
            }

            updateProgressTracking() {
                const container = document.getElementById('progressTracking');
                const progressItems = [
                    { key: 'knowledgeTransfer', label: 'Knowledge Transfer', status: this.handoverProgress.knowledgeTransfer },
                    { key: 'systemAccess', label: 'System Access Setup', status: this.handoverProgress.systemAccess },
                    { key: 'taskAssignment', label: 'Task Assignment', status: this.handoverProgress.taskAssignment },
                    { key: 'documentHandover', label: 'Document Handover', status: this.handoverProgress.documentHandover },
                    { key: 'stakeholderNotification', label: 'Stakeholder Notification', status: this.handoverProgress.stakeholderNotification }
                ];

                container.innerHTML = progressItems.map(item => `
                    <div class="progress-item">
                        <span>${item.label}</span>
                        <span class="progress-status status-${item.status}">
                            ${item.status === 'complete' ? '✅ Complete' : 
                              item.status === 'partial' ? '🔄 In Progress' : '⏳ Pending'}
                        </span>
                    </div>
                `).join('');
            }

            renderAll() {
                this.renderPositions();
                this.renderTaskPool();
                this.renderStats();
                this.renderTimeline();
                this.updateDecisionMatrix();
                this.analyzeRisks();
                this.updateProgressTracking();
            }

            // Export Functions
            exportToPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(20);
                doc.text('FWI Task Distribution Report', 20, 20);
                doc.setFontSize(12);
                doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 35);
                
                let yPos = 50;
                this.positions.forEach(position => {
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    doc.setFontSize(14);
                    doc.text(position.title, 20, yPos);
                    yPos += 10;
                    
                    doc.setFontSize(10);
                    doc.text(`Workload: ${Math.round(this.calculateWorkload(position))}%`, 25, yPos);
                    yPos += 10;
                    
                    position.selectedTasks.forEach(taskId => {
                        const task = this.getAllTasks().find(t => t.id === taskId);
                        if (task && yPos < 280) {
                            doc.text(`- ${task.title} (Due: ${new Date(task.dueDate).toLocaleDateString()})`, 30, yPos);
                            yPos += 8;
                        }
                    });
                    yPos += 10;
                });
                
                doc.save('fwi-task-distribution.pdf');
            }

            exportToCSV() {
                const allTasks = this.getAllTasks();
                let csv = 'Task,Category,Priority,Complexity,Due Date,Assigned To,Status,Description\n';
                
                allTasks.forEach(task => {
                    const assignedPosition = this.positions.find(p => p.selectedTasks.includes(task.id));
                    const assignedTo = assignedPosition ? assignedPosition.title : 'Unassigned';
                    
                    csv += `"${task.title}","${task.category}","${task.priority}",${task.complexity},"${task.dueDate}","${assignedTo}","${task.status}","${task.description}"\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'fwi-tasks.csv';
                a.click();
                window.URL.revokeObjectURL(url);
            }

            previewExport() {
                const preview = document.getElementById('exportPreview');
                const allTasks = this.getAllTasks();
                
                let content = `FWI Task Distribution Report\n`;
                content += `Generated: ${new Date().toLocaleDateString()}\n\n`;
                
                content += `SUMMARY:\n`;
                content += `Total Tasks: ${allTasks.length}\n`;
                content += `Assigned Tasks: ${allTasks.filter(t => this.positions.some(p => p.selectedTasks.includes(t.id))).length}\n`;
                content += `Critical Tasks: ${allTasks.filter(t => t.critical).length}\n\n`;
                
                this.positions.forEach(position => {
                    if (position.selectedTasks.length > 0) {
                        content += `${position.title.toUpperCase()}\n`;
                        content += `Workload: ${Math.round(this.calculateWorkload(position))}%\n`;
                        position.selectedTasks.forEach(taskId => {
                            const task = allTasks.find(t => t.id === taskId);
                            if (task) {
                                content += `- ${task.title} (Due: ${new Date(task.dueDate).toLocaleDateString()})\n`;
                            }
                        });
                        content += `\n`;
                    }
                });
                
                preview.innerHTML = content;
                preview.style.display = 'block';
            }

            generateAgenda() {
                const content = `
                    <div style="font-family: Inter, sans-serif; line-height: 1.6;">
                        <h3>FWI Programme Transition Meeting Agenda</h3>
                        <p><strong>Date:</strong> ${new Date().toLocaleDateString()}<br>
                        <strong>Purpose:</strong> Address Program Manager departure and redistribute responsibilities</p>
                        
                        <h4>1. Situation Overview (10 min)</h4>
                        <ul>
                            <li>Program Manager departure timeline and handover status</li>
                            <li>Critical tasks requiring immediate attention</li>
                            <li>Current team capacity assessment</li>
                        </ul>
                        
                        <h4>2. Task Distribution Review (20 min)</h4>
                        ${this.positions.map(pos => 
                            pos.selectedTasks.length > 0 ? 
                            `<p><strong>${pos.title}:</strong><br>${pos.selectedTasks.map(taskId => {
                                const task = this.getAllTasks().find(t => t.id === taskId);
                                return task ? `• ${task.title} (Due: ${new Date(task.dueDate).toLocaleDateString()})` : '';
                            }).join('<br>')}</p>` : ''
                        ).join('')}
                        
                        <h4>3. Next Steps (10 min)</h4>
                        <ul>
                            <li>Timeline for transition</li>
                            <li>Follow-up meeting schedule</li>
                            <li>Support and resources needed</li>
                        </ul>
                        
                        <button class="btn" onclick="navigator.clipboard.writeText(document.querySelector('#agendaContent').innerText)">Copy to Clipboard</button>
                    </div>
                `;
                
                document.getElementById('agendaContent').innerHTML = content;
                document.getElementById('agendaModal').style.display = 'block';
            }

            generateEmails() {
                const emailTemplates = this.positions.filter(pos => pos.selectedTasks.length > 0).map(position => {
                    const tasks = position.selectedTasks.map(taskId => {
                        const task = this.getAllTasks().find(t => t.id === taskId);
                        return task ? `• ${task.title}\n  Due: ${new Date(task.dueDate).toLocaleDateString()}\n  Details: ${task.description}\n` : '';
                    }).join('\n');

                    return `
                        <div style="margin-bottom: 2rem; padding: 1rem; border: 1px solid #e2e8f0; border-radius: 8px;">
                            <h4>Email for ${position.title}</h4>
                            <textarea style="width: 100%; height: 150px; font-family: monospace; padding: 1rem; border: 1px solid #e2e8f0; border-radius: 4px;" readonly>
Subject: Task Assignment - Program Manager Transition

Dear [Name],

Due to our Program Manager's departure, we need to redistribute responsibilities. You have been assigned the following tasks:

${tasks}

Please confirm your availability and let me know if you need additional support or resources.

Best regards,
[Your Name]
                            </textarea>
                            <button class="btn btn-small" onclick="navigator.clipboard.writeText(this.previousElementSibling.value)" style="margin-top: 0.5rem;">Copy Email</button>
                        </div>
                    `;
                }).join('');

                document.getElementById('emailContent').innerHTML = emailTemplates;
                document.getElementById('emailModal').style.display = 'block';
            }

            generateAnnouncement() {
                const content = `
                    <div style="font-family: Inter, sans-serif; line-height: 1.6;">
                        <h3>Team Announcement Template</h3>
                        <textarea style="width: 100%; height: 300px; font-family: monospace; padding: 1rem; border: 1px solid #e2e8f0; border-radius: 4px;" readonly>
Subject: Important Update - Program Manager Transition

Dear Team,

I want to inform you about an important transition within our FWI program. [Program Manager Name] will be leaving their position on [Date], and we have developed a comprehensive plan to ensure continuity of our critical work.

Task Redistribution:
We have carefully analyzed all ongoing responsibilities and redistributed them among team members based on capabilities and current workload:

${this.positions.filter(pos => pos.selectedTasks.length > 0).map(pos => 
`${pos.title}:
${pos.selectedTasks.map(taskId => {
    const task = this.getAllTasks().find(t => t.id === taskId);
    return task ? `- ${task.title}` : '';
}).join('\n')}
`).join('\n')}

Support and Resources:
- All necessary system access will be provided
- Knowledge transfer sessions are scheduled
- Additional support will be available during the transition

Next Steps:
- Individual meetings will be scheduled this week
- Training sessions for new responsibilities will begin immediately
- Weekly check-ins will be implemented to ensure smooth transition

Please reach out if you have any questions or concerns about these changes.

Best regards,
[Your Name]
                        </textarea>
                        <button class="btn" onclick="navigator.clipboard.writeText(this.previousElementSibling.value)" style="margin-top: 0.5rem;">Copy Announcement</button>
                    </div>
                `;
                
                document.getElementById('emailContent').innerHTML = content;
                document.getElementById('emailModal').style.display = 'block';
            }

            generateSlackUpdate() {
                const content = `
                    <div style="font-family: Inter, sans-serif; line-height: 1.6;">
                        <h3>Slack Update Template</h3>
                        <textarea style="width: 100%; height: 200px; font-family: monospace; padding: 1rem; border: 1px solid #e2e8f0; border-radius: 4px;" readonly>
🚨 IMPORTANT UPDATE - FWI Program Transition 🚨

Team, we have a structured plan for handling [PM Name]'s departure:

✅ All critical tasks have been redistributed
⏰ Evaluation study timeline remains on track  
🤝 Support systems are in place

Key assignments:
${this.positions.filter(pos => pos.selectedTasks.length > 0).slice(0, 3).map(pos => 
`• ${pos.title}: ${pos.selectedTasks.length} tasks assigned`).join('\n')}

📅 Individual meetings this week
💬 Questions? DM me or comment below

Thanks for your flexibility during this transition! 🙏
                        </textarea>
                        <button class="btn" onclick="navigator.clipboard.writeText(this.previousElementSibling.value)" style="margin-top: 0.5rem;">Copy Slack Update</button>
                    </div>
                `;
                
                document.getElementById('emailContent').innerHTML = content;
                document.getElementById('emailModal').style.display = 'block';
            }

            showHandoverChecklist() {
                const content = `
                    <div style="font-family: Inter, sans-serif; line-height: 1.6;">
                        <h3>Program Manager Handover Checklist</h3>
                        
                        <h4>🚨 Immediate Actions (Next 24 hours)</h4>
                        <ul>
                            <li>☐ Identify critical tasks requiring immediate coverage</li>
                            <li>☐ Brief team on temporary task assignments</li>
                            <li>☐ Ensure access to essential systems and documents</li>
                            <li>☐ Notify key stakeholders of transition plan</li>
                        </ul>
                        
                        <h4>📋 Knowledge Transfer (Week 1)</h4>
                        <ul>
                            <li>☐ Outcome evaluation protocols and timelines</li>
                            <li>☐ Equipment calibration procedures and schedules</li>
                            <li>☐ Farmer relationship status and key contacts</li>
                            <li>☐ Current project status and upcoming milestones</li>
                            <li>☐ Budget and resource allocation information</li>
                        </ul>
                        
                        <h4>🔑 System Access & Permissions</h4>
                        <ul>
                            <li>☐ Google Drive folders and permissions updated</li>
                            <li>☐ Lab equipment access and calibration logs</li>
                            <li>☐ Regional databases (Eluru, Nellore)</li>
                            <li>☐ Farmer contact database and forms</li>
                            <li>☐ Financial systems and procurement access</li>
                        </ul>
                        
                        <h4>👥 Stakeholder Communication</h4>
                        <ul>
                            <li>☐ Team members individually briefed</li>
                            <li>☐ Regional coordinators notified</li>
                            <li>☐ Partner organizations informed</li>
                            <li>☐ Farmers and community leaders updated</li>
                        </ul>
                        
                        <button class="btn" onclick="window.print()" style="margin-top: 1rem;">Print Checklist</button>
                        <button class="btn btn-secondary" onclick="taskManager.updateHandoverProgress()" style="margin-left: 0.5rem;">Mark Items Complete</button>
                    </div>
                `;
                
                document.getElementById('handoverContent').innerHTML = content;
                document.getElementById('handoverModal').style.display = 'block';
            }

            updateHandoverProgress() {
                // This would normally update based on user input
                // For demo purposes, we'll cycle through progress states
                const keys = Object.keys(this.handoverProgress);
                const randomKey = keys[Math.floor(Math.random() * keys.length)];
                const currentStatus = this.handoverProgress[randomKey];
                
                if (currentStatus === 'pending') {
                    this.handoverProgress[randomKey] = 'partial';
                } else if (currentStatus === 'partial') {
                    this.handoverProgress[randomKey] = 'complete';
                }
                
                this.updateProgressTracking();
            }

            // Additional Tool Functions
            generateKnowledgeTransfer() {
                this.showTemplateModal('Knowledge Transfer Guide', `
                    <h3>Knowledge Transfer Guide - Program Manager Role</h3>
                    <h4>1. Current Project Status</h4>
                    <ul>
                        <li>Outcome evaluation study: Timeline, protocols, critical deadlines</li>
                        <li>Active farmers and pond sites</li>
                        <li>Equipment status and maintenance schedules</li>
                        <li>Budget and resource allocation</li>
                    </ul>
                    
                    <h4>2. Key Relationships</h4>
                    <ul>
                        <li>Regional coordinators and their specialties</li>
                        <li>Farmer leaders and community contacts</li>
                        <li>Equipment suppliers and service providers</li>
                        <li>Partner organizations and their roles</li>
                    </ul>
                    
                    <h4>3. Standard Operating Procedures</h4>
                    <ul>
                        <li>Weekly calibration and maintenance routines</li>
                        <li>Data collection and quality control protocols</li>
                        <li>Farmer communication and visit schedules</li>
                        <li>Reporting and documentation requirements</li>
                    </ul>
                    
                    <h4>4. Problem-Solving Resources</h4>
                    <ul>
                        <li>Troubleshooting guides for common issues</li>
                        <li>Emergency contacts and escalation procedures</li>
                        <li>Historical solutions to recurring problems</li>
                    </ul>
                `);
            }

            generateRiskAssessment() {
                const allTasks = this.getAllTasks();
                const unassignedCritical = allTasks.filter(t => t.critical && !this.positions.some(p => p.selectedTasks.includes(t.id)));
                const overloadedPositions = this.positions.filter(p => this.calculateWorkload(p) > 85);
                
                this.showTemplateModal('Risk Assessment Report', `
                    <h3>Transition Risk Assessment</h3>
                    
                    <h4>🚨 High Risk Areas</h4>
                    ${unassignedCritical.length > 0 ? `
                        <div style="background: #fef2f2; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <strong>Unassigned Critical Tasks:</strong>
                            <ul>
                                ${unassignedCritical.map(task => `<li>${task.title} - Due ${this.getDeadlineText(task.dueDate)}</li>`).join('')}
                            </ul>
                        </div>
                    ` : '<p style="color: var(--success);">✅ All critical tasks assigned</p>'}
                    
                    ${overloadedPositions.length > 0 ? `
                        <div style="background: #fff7ed; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <strong>Overloaded Team Members:</strong>
                            <ul>
                                ${overloadedPositions.map(pos => `<li>${pos.title} - ${Math.round(this.calculateWorkload(pos))}% capacity</li>`).join('')}
                            </ul>
                        </div>
                    ` : '<p style="color: var(--success);">✅ No team members overloaded</p>'}
                    
                    <h4>⚠️ Medium Risk Areas</h4>
                    <ul>
                        <li>Knowledge transfer completeness</li>
                        <li>System access continuity</li>
                        <li>Stakeholder communication gaps</li>
                    </ul>
                    
                    <h4>🛡️ Mitigation Strategies</h4>
                    <ul>
                        <li>Implement buddy system for critical tasks</li>
                        <li>Schedule weekly check-ins during transition</li>
                        <li>Maintain clear escalation procedures</li>
                        <li>Document all processes and contacts</li>
                    </ul>
                `);
            }

            showTemplateModal(title, content) {
                document.getElementById('templateModalTitle').textContent = title;
                document.getElementById('templateContent').innerHTML = content + `
                    <div style="margin-top: 2rem;">
                        <button class="btn" onclick="navigator.clipboard.writeText(document.querySelector('#templateContent').innerText)">Copy Content</button>
                        <button class="btn btn-secondary" onclick="window.print()" style="margin-left: 0.5rem;">Print</button>
                    </div>
                `;
                document.getElementById('templateModal').style.display = 'block';
            }

            // Fully functional additional tools
            createTransitionPlan() {
                const allTasks = this.getAllTasks();
                const sortedTasks = allTasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                const criticalTasks = sortedTasks.filter(t => t.critical);
                const today = new Date();
                
                // Create timeline phases
                const phases = [
                    { name: "Immediate Actions", duration: "Days 1-3", tasks: sortedTasks.filter(t => this.getDaysUntilDue(t.dueDate) <= 3) },
                    { name: "Critical Task Coverage", duration: "Week 1", tasks: criticalTasks.filter(t => this.getDaysUntilDue(t.dueDate) <= 7) },
                    { name: "Knowledge Transfer", duration: "Weeks 1-2", tasks: sortedTasks.filter(t => t.category === 'outcome-evaluation') },
                    { name: "System Handover", duration: "Weeks 2-3", tasks: sortedTasks.filter(t => t.category === 'lab-operations') },
                    { name: "Relationship Transfer", duration: "Weeks 3-4", tasks: sortedTasks.filter(t => t.category === 'farmer-engagement') },
                    { name: "Full Operation", duration: "Month 2+", tasks: sortedTasks.filter(t => !t.critical) }
                ];

                this.showTemplateModal('Transition Timeline', `
                    <h3>📅 Comprehensive Transition Timeline</h3>
                    <p><strong>Total Duration:</strong> 6-8 weeks for complete transition</p>
                    
                    ${phases.map(phase => `
                        <div style="margin-bottom: 2rem; padding: 1.5rem; border-left: 4px solid var(--fwi-primary); background: var(--fwi-light);">
                            <h4 style="color: var(--fwi-dark);">${phase.name} (${phase.duration})</h4>
                            ${phase.tasks.length > 0 ? `
                                <ul>
                                    ${phase.tasks.slice(0, 5).map(task => `
                                        <li>${task.title} - Due: ${new Date(task.dueDate).toLocaleDateString()}
                                            ${this.positions.find(p => p.selectedTasks.includes(task.id)) ? 
                                                ` (Assigned to: ${this.positions.find(p => p.selectedTasks.includes(task.id)).title})` : 
                                                ' (⚠️ Unassigned)'
                                            }
                                        </li>
                                    `).join('')}
                                    ${phase.tasks.length > 5 ? `<li><em>...and ${phase.tasks.length - 5} more tasks</em></li>` : ''}
                                </ul>
                            ` : '<p><em>No specific tasks for this phase</em></p>'}
                        </div>
                    `).join('')}
                    
                    <h4>🎯 Key Milestones</h4>
                    <ul>
                        <li><strong>Day 3:</strong> All critical tasks assigned and briefed</li>
                        <li><strong>Week 1:</strong> Outcome evaluation protocols transferred</li>
                        <li><strong>Week 2:</strong> All system access granted and tested</li>
                        <li><strong>Week 3:</strong> Farmer relationships handed over</li>
                        <li><strong>Week 4:</strong> First independent operation cycle</li>
                        <li><strong>Month 2:</strong> Full autonomous operation achieved</li>
                    </ul>
                    
                    <h4>⚠️ Risk Mitigation Checkpoints</h4>
                    <ul>
                        <li>Daily check-ins during Week 1</li>
                        <li>Bi-weekly reviews for Weeks 2-4</li>
                        <li>Monthly assessments thereafter</li>
                        <li>Emergency escalation procedures documented</li>
                    </ul>
                `);
            }

            generateSOPs() {
                const tasksByCategory = {};
                this.getAllTasks().forEach(task => {
                    if (!tasksByCategory[task.category]) {
                        tasksByCategory[task.category] = [];
                    }
                    tasksByCategory[task.category].push(task);
                });

                const sopSections = {
                    'outcome-evaluation': {
                        title: 'Outcome Evaluation Study Procedures',
                        procedures: [
                            'Protocol refresher training (quarterly)',
                            'Staff shadowing at control farms (bi-weekly)',
                            'Quality control measurements (weekly)',
                            'Data validation and error checking (daily)',
                            'Compliance monitoring during corrective actions'
                        ]
                    },
                    'lab-operations': {
                        title: 'Laboratory Operations Standards',
                        procedures: [
                            'Equipment calibration (weekly on Mondays)',
                            'Reagent inventory and restocking (bi-weekly)',
                            'Quality control testing (daily)',
                            'Maintenance log updates (after each use)',
                            'Safety protocol compliance checks'
                        ]
                    },
                    'field-research': {
                        title: 'Field Research Protocols',
                        procedures: [
                            'Site visit scheduling and preparation',
                            'Data collection standardization',
                            'Equipment transport and setup',
                            'Farmer coordination and communication',
                            'Field data validation procedures'
                        ]
                    },
                    'farmer-engagement': {
                        title: 'Farmer Relationship Management',
                        procedures: [
                            'Regular relationship building visits (monthly)',
                            'Complaint handling and resolution process',
                            'New farmer onboarding procedures',
                            'Pond addition approval workflow',
                            'Community meeting organization'
                        ]
                    }
                };

                this.showTemplateModal('Standard Operating Procedures', `
                    <h3>📋 FWI Program Standard Operating Procedures</h3>
                    <p><strong>Version:</strong> 2.0 | <strong>Effective Date:</strong> ${new Date().toLocaleDateString()}</p>
                    <p><strong>Purpose:</strong> Ensure continuity of operations during and after program manager transition</p>
                    
                    ${Object.entries(sopSections).map(([category, section]) => `
                        <div style="margin-bottom: 2rem; padding: 1.5rem; border: 1px solid #e2e8f0; border-radius: 8px;">
                            <h4 style="color: var(--fwi-primary);">${section.title}</h4>
                            
                            <h5>Standard Procedures:</h5>
                            <ol>
                                ${section.procedures.map(procedure => `<li>${procedure}</li>`).join('')}
                            </ol>
                            
                            ${tasksByCategory[category] ? `
                                <h5>Current Active Tasks:</h5>
                                <ul>
                                    ${tasksByCategory[category].map(task => `
                                        <li>${task.title} - Priority: ${task.priority}
                                            ${this.positions.find(p => p.selectedTasks.includes(task.id)) ? 
                                                ` | Assigned to: ${this.positions.find(p => p.selectedTasks.includes(task.id)).title}` : 
                                                ' | ⚠️ Unassigned'
                                            }
                                        </li>
                                    `).join('')}
                                </ul>
                            ` : ''}
                            
                            <h5>Quality Standards:</h5>
                            <ul>
                                <li>All procedures must be documented in real-time</li>
                                <li>Deviations require supervisor approval</li>
                                <li>Weekly review and validation required</li>
                                <li>Training updates quarterly</li>
                            </ul>
                        </div>
                    `).join('')}
                    
                    <h4>🚨 Emergency Procedures</h4>
                    <ul>
                        <li><strong>Equipment Failure:</strong> Contact supplier immediately, document issue, implement backup procedures</li>
                        <li><strong>Data Loss:</strong> Activate backup systems, notify R&D support, initiate recovery protocols</li>
                        <li><strong>Farmer Complaints:</strong> Document thoroughly, escalate within 24 hours, implement resolution plan</li>
                        <li><strong>Staff Absence:</strong> Cross-training protocols, temporary reassignment procedures</li>
                    </ul>
                    
                    <h4>📊 Performance Indicators</h4>
                    <ul>
                        <li>Task completion rate: >95%</li>
                        <li>Quality control compliance: 100%</li>
                        <li>Farmer satisfaction: >90%</li>
                        <li>Equipment uptime: >98%</li>
                    </ul>
                `);
            }

            generateProgressReport() {
                const allTasks = this.getAllTasks();
                const assignedTasks = allTasks.filter(task => this.positions.some(p => p.selectedTasks.includes(task.id)));
                const criticalAssigned = allTasks.filter(task => task.critical && this.positions.some(p => p.selectedTasks.includes(task.id)));
                const overdueTasks = allTasks.filter(task => this.getDeadlineStatus(task.dueDate) === 'overdue');
                
                const progressPercentage = Math.round((assignedTasks.length / allTasks.length) * 100);
                const criticalProgressPercentage = Math.round((criticalAssigned.length / allTasks.filter(t => t.critical).length) * 100);
                
                const workloadAnalysis = this.positions.map(pos => ({
                    position: pos,
                    workload: this.calculateWorkload(pos),
                    tasks: pos.selectedTasks.length
                }));

                const handoverCompletionItems = Object.entries(this.handoverProgress);
                const completedItems = handoverCompletionItems.filter(([key, status]) => status === 'complete').length;
                const handoverProgress = Math.round((completedItems / handoverCompletionItems.length) * 100);

                this.showTemplateModal('Transition Progress Report', `
                    <h3>📊 FWI Program Transition Progress Report</h3>
                    <p><strong>Report Date:</strong> ${new Date().toLocaleDateString()} | <strong>Reporting Period:</strong> Transition Phase</p>
                    
                    <h4>📈 Overall Progress Summary</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 1rem 0;">
                        <div style="background: var(--fwi-light); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--fwi-primary);">${progressPercentage}%</div>
                            <div>Tasks Assigned</div>
                        </div>
                        <div style="background: ${criticalProgressPercentage === 100 ? '#d1fae5' : '#fef3c7'}; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: ${criticalProgressPercentage === 100 ? 'var(--success)' : 'var(--warning)'};">${criticalProgressPercentage}%</div>
                            <div>Critical Tasks Covered</div>
                        </div>
                        <div style="background: var(--fwi-light); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--fwi-primary);">${handoverProgress}%</div>
                            <div>Handover Complete</div>
                        </div>
                        <div style="background: ${overdueTasks.length === 0 ? '#d1fae5' : '#fecaca'}; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: ${overdueTasks.length === 0 ? 'var(--success)' : 'var(--danger)'};">${overdueTasks.length}</div>
                            <div>Overdue Tasks</div>
                        </div>
                    </div>
                    
                    <h4>👥 Team Workload Analysis</h4>
                    ${workloadAnalysis.map(item => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; margin: 0.5rem 0; background: white; border-radius: 8px; border-left: 4px solid ${item.workload > 85 ? 'var(--danger)' : item.workload > 65 ? 'var(--warning)' : 'var(--success)'};">
                            <span><strong>${item.position.title}</strong></span>
                            <span>${item.tasks} tasks (${Math.round(item.workload)}% capacity)</span>
                        </div>
                    `).join('')}
                    
                    <h4>⚠️ Risk Assessment</h4>
                    <ul>
                        ${overdueTasks.length > 0 ? `<li style="color: var(--danger);"><strong>HIGH:</strong> ${overdueTasks.length} overdue tasks requiring immediate attention</li>` : ''}
                        ${workloadAnalysis.filter(w => w.workload > 85).length > 0 ? `<li style="color: var(--warning);"><strong>MEDIUM:</strong> ${workloadAnalysis.filter(w => w.workload > 85).length} team members overloaded</li>` : ''}
                        ${allTasks.filter(t => !this.positions.some(p => p.selectedTasks.includes(t.id))).length > 0 ? `<li style="color: var(--warning);"><strong>MEDIUM:</strong> ${allTasks.filter(t => !this.positions.some(p => p.selectedTasks.includes(t.id))).length} unassigned tasks</li>` : ''}
                        ${overdueTasks.length === 0 && workloadAnalysis.filter(w => w.workload > 85).length === 0 ? '<li style="color: var(--success);"><strong>LOW:</strong> No critical risks identified</li>' : ''}
                    </ul>
                    
                    <h4>🎯 Next Actions Required</h4>
                    <ol>
                        ${progressPercentage < 100 ? '<li>Complete task assignments for all unassigned items</li>' : ''}
                        ${handoverProgress < 100 ? '<li>Finalize handover checklist items</li>' : ''}
                        ${overdueTasks.length > 0 ? '<li>Address overdue tasks immediately</li>' : ''}
                        <li>Schedule weekly progress review meetings</li>
                        <li>Implement performance monitoring systems</li>
                        <li>Establish feedback mechanisms with stakeholders</li>
                    </ol>
                    
                    <h4>📅 Timeline Status</h4>
                    <p><strong>Current Phase:</strong> ${progressPercentage < 50 ? 'Initial Planning' : progressPercentage < 80 ? 'Active Transition' : 'Finalization'}</p>
                    <p><strong>Expected Completion:</strong> ${handoverProgress > 75 ? 'On Track' : handoverProgress > 50 ? 'Minor Delays Expected' : 'Significant Delays Possible'}</p>
                    <p><strong>Recommendation:</strong> ${handoverProgress > 75 ? 'Continue current pace' : 'Accelerate handover activities and increase support'}</p>
                `);
            }

            createContingencyPlan() {
                const allTasks = this.getAllTasks();
                const criticalTasks = allTasks.filter(t => t.critical);
                const unassignedCritical = criticalTasks.filter(t => !this.positions.some(p => p.selectedTasks.includes(t.id)));
                const overloadedPositions = this.positions.filter(p => this.calculateWorkload(p) > 85);
                const singlePointsOfFailure = this.positions.filter(p => p.selectedTasks.filter(taskId => {
                    const task = allTasks.find(t => t.id === taskId);
                    return task && task.critical;
                }).length > 0);

                this.showTemplateModal('Contingency Plan', `
                    <h3>🛡️ FWI Program Transition Contingency Plan</h3>
                    <p><strong>Plan Version:</strong> 1.0 | <strong>Effective Date:</strong> ${new Date().toLocaleDateString()}</p>
                    <p><strong>Scope:</strong> Risk mitigation during Program Manager transition period</p>
                    
                    <h4>🚨 Critical Risk Scenarios & Responses</h4>
                    
                    <div style="margin-bottom: 2rem; padding: 1.5rem; border: 2px solid var(--danger); border-radius: 8px; background: #fef2f2;">
                        <h5 style="color: var(--danger);">SCENARIO 1: Key Personnel Unavailability</h5>
                        <p><strong>Risk:</strong> Assigned team member becomes unavailable during critical tasks</p>
                        <p><strong>Trigger:</strong> >24 hour absence during critical task period</p>
                        <p><strong>Response:</strong></p>
                        <ul>
                            <li><strong>Immediate (0-4 hours):</strong> Activate backup assignments</li>
                            <li><strong>Short-term (4-24 hours):</strong> Redistribute critical tasks</li>
                            <li><strong>Medium-term (1-7 days):</strong> Implement cross-training protocols</li>
                        </ul>
                        <p><strong>Backup Assignments:</strong></p>
                        <ul>
                            ${singlePointsOfFailure.map(pos => `
                                <li>${pos.title} → Backup: ${this.positions.find(p => p.id !== pos.id && p.currentWorkload < 70)?.title || 'R&D Support Staff'}</li>
                            `).join('')}
                        </ul>
                    </div>

                    <div style="margin-bottom: 2rem; padding: 1.5rem; border: 2px solid var(--warning); border-radius: 8px; background: #fff7ed;">
                        <h5 style="color: var(--warning);">SCENARIO 2: Critical Task Delays</h5>
                        <p><strong>Risk:</strong> Outcome evaluation study timeline compromised</p>
                        <p><strong>Trigger:</strong> Any critical task >48 hours overdue</p>
                        <p><strong>Response:</strong></p>
                        <ul>
                            <li><strong>Immediate:</strong> Escalate to R&D management</li>
                            <li><strong>4 hours:</strong> Reassign resources from non-critical tasks</li>
                            <li><strong>24 hours:</strong> Request external consultant support</li>
                            <li><strong>48 hours:</strong> Activate emergency protocols</li>
                        </ul>
                        <p><strong>Resource Reallocation Matrix:</strong></p>
                        <ul>
                            <li>Outcome evaluation tasks: Top priority - all resources available</li>
                            <li>Lab operations: Reduce to essential calibration only</li>
                            <li>Farmer visits: Defer non-critical relationship building</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 2rem; padding: 1.5rem; border: 2px solid var(--fwi-primary); border-radius: 8px; background: var(--fwi-light);">
                        <h5 style="color: var(--fwi-dark);">SCENARIO 3: System Access Issues</h5>
                        <p><strong>Risk:</strong> Loss of access to critical systems or data</p>
                        <p><strong>Trigger:</strong> Any system unavailable >2 hours</p>
                        <p><strong>Response:</strong></p>
                        <ul>
                            <li><strong>Immediate:</strong> Switch to backup systems/manual processes</li>
                            <li><strong>2 hours:</strong> Contact IT support and system administrators</li>
                            <li><strong>4 hours:</strong> Implement paper-based temporary procedures</li>
                            <li><strong>24 hours:</strong> Escalate to senior management</li>
                        </ul>
                        <p><strong>Backup Procedures:</strong></p>
                        <ul>
                            <li>Equipment logs: Paper-based recording system</li>
                            <li>Data collection: Manual forms with delayed digital entry</li>
                            <li>Communication: Phone trees and email backups</li>
                        </ul>
                    </div>

                    <h4>📞 Emergency Contact Tree</h4>
                    <ol>
                        <li><strong>Primary Escalation:</strong> Senior Program Associate</li>
                        <li><strong>Secondary Escalation:</strong> R&D Support Staff</li>
                        <li><strong>Management Escalation:</strong> Department Head</li>
                        <li><strong>External Support:</strong> ExPros Associate</li>
                    </ol>

                    <h4>📋 Decision Authority Matrix</h4>
                    <ul>
                        <li><strong>Task Reassignment (non-critical):</strong> Senior PA</li>
                        <li><strong>Resource Reallocation:</strong> Department Head approval required</li>
                        <li><strong>Timeline Extensions:</strong> Management committee decision</li>
                        <li><strong>External Contractor Hiring:</strong> Senior management approval</li>
                    </ul>

                    <h4>🔄 Recovery Procedures</h4>
                    <ol>
                        <li><strong>Immediate Recovery (0-24 hours):</strong> Restore normal operations, document incident</li>
                        <li><strong>Short-term Recovery (1-7 days):</strong> Analyze root causes, implement improvements</li>
                        <li><strong>Long-term Recovery (1-4 weeks):</strong> Review and update contingency plans</li>
                    </ol>

                    <h4>📊 Monitoring & Review</h4>
                    <ul>
                        <li><strong>Daily:</strong> Risk indicator monitoring during transition period</li>
                        <li><strong>Weekly:</strong> Contingency plan effectiveness review</li>
                        <li><strong>Monthly:</strong> Plan updates based on lessons learned</li>
                    </ul>
                `);
            }

            scheduleCheckIns() {
                const today = new Date();
                const checkInSchedule = [];
                
                // Generate check-in schedule for next 8 weeks
                for (let week = 0; week < 8; week++) {
                    const checkInDate = new Date(today);
                    checkInDate.setDate(today.getDate() + (week * 7));
                    
                    let frequency, focus, attendees;
                    if (week < 2) {
                        frequency = 'Daily + Weekly Summary';
                        focus = 'Critical task coverage and immediate issues';
                        attendees = 'All assigned team members + Management';
                    } else if (week < 4) {
                        frequency = 'Bi-weekly';
                        focus = 'Progress review and adjustment';
                        attendees = 'Team leads + Management';
                    } else {
                        frequency = 'Weekly';
                        focus = 'Performance monitoring and optimization';
                        attendees = 'Team leads (Management as needed)';
                    }
                    
                    checkInSchedule.push({
                        week: week + 1,
                        date: checkInDate,
                        frequency,
                        focus,
                        attendees
                    });
                }

                this.showTemplateModal('Check-in Schedule', `
                    <h3>📅 Transition Check-in Schedule</h3>
                    <p><strong>Schedule Period:</strong> ${today.toLocaleDateString()} - ${checkInSchedule[7].date.toLocaleDateString()}</p>
                    <p><strong>Purpose:</strong> Ensure smooth transition with regular monitoring and support</p>
                    
                    <h4>📋 Check-in Calendar</h4>
                    ${checkInSchedule.map(item => `
                        <div style="margin-bottom: 1.5rem; padding: 1rem; border-left: 4px solid var(--fwi-primary); background: ${item.week <= 2 ? '#fef2f2' : item.week <= 4 ? '#fff7ed' : 'var(--fwi-light)'};">
                            <h5>Week ${item.week} - Starting ${item.date.toLocaleDateString()}</h5>
                            <p><strong>Frequency:</strong> ${item.frequency}</p>
                            <p><strong>Focus:</strong> ${item.focus}</p>
                            <p><strong>Attendees:</strong> ${item.attendees}</p>
                            ${item.week <= 2 ? '<p style="color: var(--danger);"><strong>⚠️ Critical Period:</strong> Daily monitoring required</p>' : ''}
                        </div>
                    `).join('')}
                    
                    <h4>📝 Standard Agenda Template</h4>
                    <ol>
                        <li><strong>Progress Review (10 min)</strong>
                            <ul>
                                <li>Task completion status</li>
                                <li>Deadline adherence</li>
                                <li>Quality metrics</li>
                            </ul>
                        </li>
                        <li><strong>Issues & Challenges (15 min)</strong>
                            <ul>
                                <li>Current blockers</li>
                                <li>Resource needs</li>
                                <li>Technical difficulties</li>
                            </ul>
                        </li>
                        <li><strong>Support & Solutions (10 min)</strong>
                            <ul>
                                <li>Required assistance</li>
                                <li>Training needs</li>
                                <li>Process improvements</li>
                            </ul>
                        </li>
                        <li><strong>Next Period Planning (5 min)</strong>
                            <ul>
                                <li>Upcoming priorities</li>
                                <li>Resource allocation</li>
                                <li>Risk mitigation</li>
                            </ul>
                        </li>
                    </ol>
                    
                    <h4>📊 Key Performance Indicators to Track</h4>
                    <ul>
                        <li><strong>Task Completion Rate:</strong> % of assigned tasks completed on time</li>
                        <li><strong>Quality Metrics:</strong> Error rates, rework requirements</li>
                        <li><strong>Team Confidence:</strong> Self-reported capability levels</li>
                        <li><strong>Stakeholder Satisfaction:</strong> Farmer/partner feedback</li>
                        <li><strong>System Performance:</strong> Equipment uptime, data accuracy</li>
                    </ul>
                    
                    <h4>⚠️ Escalation Triggers</h4>
                    <ul>
                        <li>Any critical task >24 hours overdue</li>
                        <li>Team member confidence <70%</li>
                        <li>Quality metrics decline >20%</li>
                        <li>Multiple system failures in same week</li>
                        <li>Stakeholder complaints increase</li>
                    </ul>
                    
                    <h4>📧 Meeting Logistics</h4>
                    <p><strong>Format:</strong> Video conference with screen sharing for data review</p>
                    <p><strong>Duration:</strong> 30-45 minutes (longer for crisis situations)</p>
                    <p><strong>Documentation:</strong> Brief meeting notes shared within 24 hours</p>
                    <p><strong>Follow-up:</strong> Action items tracked and reviewed next meeting</p>
                `);
            }

            generateJobDescription() {
                const tasksByCategory = {};
                this.getAllTasks().forEach(task => {
                    if (!tasksByCategory[task.category]) {
                        tasksByCategory[task.category] = [];
                    }
                    tasksByCategory[task.category].push(task);
                });

                // Analyze current assignments to understand role requirements
                const roleAnalysis = this.positions.map(pos => ({
                    position: pos,
                    tasks: pos.selectedTasks.map(taskId => this.getAllTasks().find(t => t.id === taskId)).filter(Boolean),
                    totalComplexity: pos.selectedTasks.reduce((sum, taskId) => {
                        const task = this.getAllTasks().find(t => t.id === taskId);
                        return sum + (task ? task.complexity : 0);
                    }, 0)
                }));

                this.showTemplateModal('Job Description Templates', `
                    <h3>👔 Job Description Templates for New Roles</h3>
                    <p><strong>Generated Date:</strong> ${new Date().toLocaleDateString()}</p>
                    <p><strong>Based on:</strong> Current task redistribution analysis</p>
                    
                    <div style="margin-bottom: 2rem; padding: 1.5rem; border: 2px solid var(--fwi-primary); border-radius: 8px;">
                        <h4>Program Manager - FWI Aquaculture Research</h4>
                        <p><strong>Department:</strong> Research & Development</p>
                        <p><strong>Reports to:</strong> Senior Research Director</p>
                        <p><strong>Employment Type:</strong> Full-time, Permanent</p>
                        
                        <h5>Position Summary:</h5>
                        <p>Lead the FWI aquaculture research program, managing field operations, outcome evaluation studies, and team coordination. Responsible for ensuring research quality, stakeholder relationships, and operational excellence across multiple regions.</p>
                        
                        <h5>Key Responsibilities:</h5>
                        <ul>
                            <li><strong>Research Management (40%)</strong>
                                <ul>
                                    <li>Oversee outcome evaluation study protocols and implementation</li>
                                    <li>Ensure data quality and research integrity</li>
                                    <li>Coordinate with external research partners (ExPros)</li>
                                    <li>Manage research timelines and deliverables</li>
                                </ul>
                            </li>
                            <li><strong>Laboratory Operations (25%)</strong>
                                <ul>
                                    <li>Supervise equipment calibration and maintenance</li>
                                    <li>Manage reagent inventory and procurement</li>
                                    <li>Ensure compliance with quality control protocols</li>
                                    <li>Oversee safety and regulatory compliance</li>
                                </ul>
                            </li>
                            <li><strong>Team Leadership (20%)</strong>
                                <ul>
                                    <li>Manage Program Associates across Eluru and Nellore regions</li>
                                    <li>Conduct performance reviews and development planning</li>
                                    <li>Provide training and mentorship</li>
                                    <li>Coordinate with R&D support staff</li>
                                </ul>
                            </li>
                            <li><strong>Stakeholder Relations (15%)</strong>
                                <ul>
                                    <li>Maintain relationships with participating farmers</li>
                                    <li>Address farmer concerns and feedback</li>
                                    <li>Coordinate with regional coordinators</li>
                                    <li>Manage community engagement activities</li>
                                </ul>
                            </li>
                        </ul>
                        
                        <h5>Required Qualifications:</h5>
                        <ul>
                            <li>Master's degree in Aquaculture, Marine Biology, or related field</li>
                            <li>Minimum 5 years experience in aquaculture research</li>
                            <li>Proven team management experience (3+ direct reports)</li>
                            <li>Experience with field research and data collection</li>
                            <li>Strong analytical and problem-solving skills</li>
                        </ul>
                        
                        <h5>Preferred Qualifications:</h5>
                        <ul>
                            <li>PhD in relevant field</li>
                            <li>Experience with rural community engagement</li>
                            <li>Knowledge of Indian aquaculture practices</li>
                            <li>Proficiency in regional languages (Telugu preferred)</li>
                            <li>Experience with outcome evaluation methodologies</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 2rem; padding: 1.5rem; border: 2px solid var(--success); border-radius: 8px;">
                        <h4>Laboratory Operations Manager</h4>
                        <p><strong>Department:</strong> Research & Development</p>
                        <p><strong>Reports to:</strong> Program Manager</p>
                        <p><strong>Employment Type:</strong> Full-time, Permanent</p>
                        
                        <h5>Position Summary:</h5>
                        <p>Specialized role focused on laboratory operations, equipment management, and quality control for the FWI aquaculture research program. Ensures operational excellence and supports field research activities.</p>
                        
                        <h5>Key Responsibilities:</h5>
                        <ul>
                            <li>Equipment calibration and maintenance (daily)</li>
                            <li>Quality control testing and validation</li>
                            <li>Inventory management and procurement</li>
                            <li>Training staff on laboratory procedures</li>
                            <li>Safety and compliance oversight</li>
                        </ul>
                        
                        <h5>Required Qualifications:</h5>
                        <ul>
                            <li>Bachelor's degree in Chemistry, Biology, or related field</li>
                            <li>3+ years laboratory management experience</li>
                            <li>Experience with analytical equipment and calibration</li>
                            <li>Strong attention to detail and quality focus</li>
                        </ul>
                    </div>
                    
                    <h4>📊 Role Distribution Analysis</h4>
                    <p>Based on current task assignments:</p>
                    ${roleAnalysis.filter(r => r.tasks.length > 0).map(role => `
                        <div style="margin-bottom: 1rem; padding: 1rem; background: var(--fwi-light); border-radius: 8px;">
                            <strong>${role.position.title}</strong><br>
                            Tasks: ${role.tasks.length} | Complexity Score: ${role.totalComplexity}<br>
                            <em>Primary Categories: ${[...new Set(role.tasks.map(t => t.category))].join(', ')}</em>
                        </div>
                    `).join('')}
                    
                    <h4>💰 Compensation Guidelines</h4>
                    <ul>
                        <li><strong>Program Manager:</strong> ₹8-12 lakhs annually (based on experience)</li>
                        <li><strong>Lab Operations Manager:</strong> ₹5-8 lakhs annually</li>
                        <li><strong>Additional Benefits:</strong> Health insurance, professional development, field allowances</li>
                    </ul>
                `);
            }

            generateTrainingPlan() {
                // Analyze skill gaps based on task assignments
                const skillGaps = [];
                const trainingNeeds = {};
                
                this.positions.forEach(position => {
                    if (position.selectedTasks.length > 0) {
                        const assignedTasks = position.selectedTasks.map(taskId => 
                            this.getAllTasks().find(t => t.id === taskId)
                        ).filter(Boolean);
                        
                        const requiredSkills = [];
                        assignedTasks.forEach(task => {
                            switch(task.category) {
                                case 'outcome-evaluation':
                                    requiredSkills.push('Research Protocols', 'Data Collection', 'Quality Control');
                                    break;
                                case 'lab-operations':
                                    requiredSkills.push('Equipment Calibration', 'Laboratory Safety', 'Quality Testing');
                                    break;
                                case 'farmer-engagement':
                                    requiredSkills.push('Communication', 'Relationship Management', 'Conflict Resolution');
                                    break;
                                case 'field-research':
                                    requiredSkills.push('Field Methodology', 'Data Collection', 'Equipment Operation');
                                    break;
                            }
                        });
                        
                        const skillGap = requiredSkills.filter(skill => 
                            !position.capabilities.some(cap => cap.toLowerCase().includes(skill.toLowerCase()))
                        );
                        
                        if (skillGap.length > 0) {
                            trainingNeeds[position.id] = {
                                position: position.title,
                                gaps: [...new Set(skillGap)],
                                urgency: assignedTasks.some(t => t.critical) ? 'High' : 'Medium'
                            };
                        }
                    }
                });

                this.showTemplateModal('Training & Development Plan', `
                    <h3>🎓 FWI Program Training & Development Plan</h3>
                    <p><strong>Plan Period:</strong> ${new Date().toLocaleDateString()} - ${new Date(Date.now() + 90*24*60*60*1000).toLocaleDateString()}</p>
                    <p><strong>Objective:</strong> Bridge skill gaps and ensure competency for new responsibilities</p>
                    
                    <h4>🎯 Individual Training Plans</h4>
                    ${Object.values(trainingNeeds).map(need => `
                        <div style="margin-bottom: 2rem; padding: 1.5rem; border: 2px solid ${need.urgency === 'High' ? 'var(--danger)' : 'var(--warning)'}; border-radius: 8px; background: ${need.urgency === 'High' ? '#fef2f2' : '#fff7ed'};">
                            <h5>${need.position} - ${need.urgency} Priority</h5>
                            <p><strong>Identified Skill Gaps:</strong></p>
                            <ul>
                                ${need.gaps.map(gap => `<li>${gap}</li>`).join('')}
                            </ul>
                            
                            <h6>Recommended Training:</h6>
                            <ul>
                                ${need.gaps.map(gap => {
                                    switch(gap) {
                                        case 'Research Protocols':
                                            return '<li><strong>Research Protocols:</strong> 2-day intensive with ExPros associate, hands-on shadowing</li>';
                                        case 'Equipment Calibration':
                                            return '<li><strong>Equipment Calibration:</strong> 1-day technical training with current PM, weekly practice sessions</li>';
                                        case 'Communication':
                                            return '<li><strong>Farmer Communication:</strong> 1-day workshop on community engagement, field practice</li>';
                                        case 'Quality Control':
                                            return '<li><strong>Quality Control:</strong> 3-day comprehensive training, certification program</li>';
                                        default:
                                            return `<li><strong>${gap}:</strong> Customized training program based on specific needs</li>`;
                                    }
                                }).join('')}
                            </ul>
                            
                            <p><strong>Timeline:</strong> ${need.urgency === 'High' ? 'Complete within 2 weeks' : 'Complete within 4 weeks'}</p>
                        </div>
                    `).join('')}
                    
                    ${Object.keys(trainingNeeds).length === 0 ? 
                        '<div style="text-align: center; padding: 2rem; color: var(--success);"><strong>✅ No critical skill gaps identified</strong><br>Current team capabilities match assigned responsibilities well.</div>' : ''
                    }
                    
                    <h4>📚 Training Program Components</h4>
                    
                    <div style="margin-bottom: 1.5rem; padding: 1rem; border-left: 4px solid var(--fwi-primary); background: var(--fwi-light);">
                        <h5>1. Core Competency Training (All Staff)</h5>
                        <ul>
                            <li><strong>Week 1:</strong> FWI Program Overview & Objectives</li>
                            <li><strong>Week 2:</strong> Data Collection Standardization</li>
                            <li><strong>Week 3:</strong> Communication & Stakeholder Management</li>
                            <li><strong>Week 4:</strong> Emergency Procedures & Problem Solving</li>
                        </ul>
                        <p><strong>Format:</strong> 2-hour weekly sessions, mix of theory and practical exercises</p>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem; padding: 1rem; border-left: 4px solid var(--success); background: #f0fdf4;">
                        <h5>2. Specialized Technical Training</h5>
                        <ul>
                            <li><strong>Laboratory Operations:</strong> Equipment calibration, safety protocols, quality control</li>
                            <li><strong>Field Research:</strong> Measurement techniques, data validation, equipment maintenance</li>
                            <li><strong>Farmer Relations:</strong> Communication strategies, conflict resolution, community engagement</li>
                        </ul>
                        <p><strong>Format:</strong> Intensive workshops with hands-on practice and certification</p>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem; padding: 1rem; border-left: 4px solid var(--warning); background: #fff7ed;">
                        <h5>3. Leadership Development (Senior Staff)</h5>
                        <ul>
                            <li>Team management and delegation</li>
                            <li>Decision-making under pressure</li>
                            <li>Performance management and feedback</li>
                            <li>Strategic thinking and planning</li>
                        </ul>
                        <p><strong>Format:</strong> Monthly workshops plus individual mentoring</p>
                    </div>
                    
                    <h4>📅 Training Schedule</h4>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="background: var(--fwi-light);">
                            <th style="border: 1px solid #e2e8f0; padding: 0.5rem;">Week</th>
                            <th style="border: 1px solid #e2e8f0; padding: 0.5rem;">Focus</th>
                            <th style="border: 1px solid #e2e8f0; padding: 0.5rem;">Target Audience</th>
                            <th style="border: 1px solid #e2e8f0; padding: 0.5rem;">Duration</th>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">1</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">Critical Task Handover</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">Assigned Critical Task Owners</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">Daily sessions</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">2-3</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">Technical Skills Training</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">All Staff (by specialization)</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">Half-day workshops</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">4-6</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">Practical Application</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">All Staff</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">On-the-job training</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">7-8</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">Assessment & Certification</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">All Staff</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">Individual assessments</td>
                        </tr>
                    </table>
                    
                    <h4>📊 Success Metrics</h4>
                    <ul>
                        <li><strong>Competency Assessment Scores:</strong> >85% pass rate</li>
                        <li><strong>Task Performance:</strong> No quality degradation post-training</li>
                        <li><strong>Confidence Levels:</strong> Self-reported confidence >80%</li>
                        <li><strong>Feedback Scores:</strong> Training effectiveness >4.0/5.0</li>
                    </ul>
                    
                    <h4>💰 Training Budget Estimate</h4>
                    <ul>
                        <li><strong>External Trainers:</strong> ₹50,000 - ₹75,000</li>
                        <li><strong>Materials & Resources:</strong> ₹15,000 - ₹25,000</li>
                        <li><strong>Staff Time (opportunity cost):</strong> ₹100,000 - ₹150,000</li>
                        <li><strong>Total Estimated Cost:</strong> ₹165,000 - ₹250,000</li>
                    </ul>
                `);
            }

            generatePerformanceMetrics() {
                const allTasks = this.getAllTasks();
                const criticalTasks = allTasks.filter(t => t.critical);
                const assignedPositions = this.positions.filter(p => p.selectedTasks.length > 0);

                this.showTemplateModal('Performance Metrics Framework', `
                    <h3>📊 FWI Program Performance Metrics Framework</h3>
                    <p><strong>Measurement Period:</strong> Transition Period + Ongoing Operations</p>
                    <p><strong>Review Frequency:</strong> Weekly (transition), Monthly (steady-state)</p>
                    
                    <h4>🎯 Key Performance Indicators (KPIs)</h4>
                    
                    <div style="margin-bottom: 2rem; padding: 1.5rem; border: 2px solid var(--danger); border-radius: 8px; background: #fef2f2;">
                        <h5 style="color: var(--danger);">CRITICAL METRICS (Must Track Daily)</h5>
                        
                        <h6>1. Research Integrity & Timeline Adherence</h6>
                        <ul>
                            <li><strong>Outcome Evaluation Milestone Completion:</strong> 100% on-time delivery required</li>
                            <li><strong>Data Quality Score:</strong> >95% accuracy in all measurements</li>
                            <li><strong>Protocol Compliance Rate:</strong> 100% adherence to research protocols</li>
                            <li><strong>Critical Task Completion Rate:</strong> 100% within defined timelines</li>
                        </ul>
                        
                        <h6>Current Status:</h6>
                        <ul>
                            <li>Critical Tasks Assigned: ${criticalTasks.filter(t => this.positions.some(p => p.selectedTasks.includes(t.id))).length}/${criticalTasks.length}</li>
                            <li>Overdue Critical Tasks: ${criticalTasks.filter(t => this.getDeadlineStatus(t.dueDate) === 'overdue').length}</li>
                            <li>Risk Level: ${criticalTasks.filter(t => !this.positions.some(p => p.selectedTasks.includes(t.id))).length > 0 ? 'HIGH' : 'LOW'}</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 2rem; padding: 1.5rem; border: 2px solid var(--warning); border-radius: 8px; background: #fff7ed;">
                        <h5 style="color: var(--warning);">OPERATIONAL METRICS (Weekly Tracking)</h5>
                        
                        <h6>2. Laboratory Operations Efficiency</h6>
                        <ul>
                            <li><strong>Equipment Uptime:</strong> >98% availability</li>
                            <li><strong>Calibration Compliance:</strong> 100% on-schedule calibrations</li>
                            <li><strong>Quality Control Pass Rate:</strong> >95% first-time pass</li>
                            <li><strong>Inventory Availability:</strong> Zero stockouts of critical reagents</li>
                        </ul>
                        
                        <h6>3. Team Performance & Capacity</h6>
                        <ul>
                            <li><strong>Task Completion Rate:</strong> >90% tasks completed on time</li>
                            <li><strong>Workload Distribution:</strong> No individual >85% capacity sustained</li>
                            <li><strong>Training Completion:</strong> 100% required training within timeline</li>
                            <li><strong>Staff Confidence Level:</strong> >80% self-reported competency</li>
                        </ul>
                        
                        <h6>Current Team Status:</h6>
                        ${assignedPositions.map(pos => `
                            <li>${pos.title}: ${pos.selectedTasks.length} tasks, ${Math.round(this.calculateWorkload(pos))}% capacity</li>
                        `).join('')}
                    </div>
                    
                    <div style="margin-bottom: 2rem; padding: 1.5rem; border: 2px solid var(--fwi-primary); border-radius: 8px; background: var(--fwi-light);">
                        <h5 style="color: var(--fwi-dark);">STAKEHOLDER SATISFACTION (Monthly Tracking)</h5>
                        
                        <h6>4. Farmer & Community Relations</h6>
                        <ul>
                            <li><strong>Farmer Satisfaction Score:</strong> >4.0/5.0 (quarterly survey)</li>
                            <li><strong>Complaint Resolution Time:</strong> <48 hours average</li>
                            <li><strong>Community Engagement Rate:</strong> >90% participation in scheduled activities</li>
                            <li><strong>Relationship Quality Index:</strong> Maintained or improved vs. baseline</li>
                        </ul>
                        
                        <h6>5. Internal Stakeholder Satisfaction</h6>
                        <ul>
                            <li><strong>Management Confidence:</strong> >4.0/5.0 monthly rating</li>
                            <li><strong>R&D Integration Score:</strong> Seamless collaboration maintained</li>
                            <li><strong>Partner Organization Feedback:</strong> No deterioration in relationships</li>
                        </ul>
                    </div>
                    
                    <h4>📈 Performance Tracking Dashboard</h4>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 1.5rem;">
                        <tr style="background: var(--fwi-light);">
                            <th style="border: 1px solid #e2e8f0; padding: 0.5rem;">Metric Category</th>
                            <th style="border: 1px solid #e2e8f0; padding: 0.5rem;">Target</th>
                            <th style="border: 1px solid #e2e8f0; padding: 0.5rem;">Current Status</th>
                            <th style="border: 1px solid #e2e8f0; padding: 0.5rem;">Trend</th>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">Critical Task Coverage</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">100%</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">${Math.round((criticalTasks.filter(t => this.positions.some(p => p.selectedTasks.includes(t.id))).length / criticalTasks.length) * 100)}%</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">📈 Improving</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">Team Workload Balance</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;"><85% max</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">${assignedPositions.filter(p => this.calculateWorkload(p) > 85).length === 0 ? 'Within Target' : 'Over Capacity'}</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">${assignedPositions.filter(p => this.calculateWorkload(p) > 85).length === 0 ? '✅ Good' : '⚠️ Monitor'}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">Task Assignment Rate</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">100%</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">${Math.round((allTasks.filter(t => this.positions.some(p => p.selectedTasks.includes(t.id))).length / allTasks.length) * 100)}%</td>
                            <td style="border: 1px solid #e2e8f0; padding: 0.5rem;">📈 Improving</td>
                        </tr>
                    </table>
                    
                    <h4>🚨 Alert Thresholds & Escalation</h4>
                    <ul>
                        <li><strong>RED ALERT:</strong> Any critical metric falls below threshold → Immediate management intervention</li>
                        <li><strong>YELLOW WARNING:</strong> Declining trend over 2 consecutive periods → Enhanced monitoring</li>
                        <li><strong>GREEN STATUS:</strong> All metrics within target range → Standard monitoring</li>
                    </ul>
                    
                    <h4>📊 Reporting Schedule</h4>
                    <ul>
                        <li><strong>Daily:</strong> Critical metrics dashboard (during transition)</li>
                        <li><strong>Weekly:</strong> Operational metrics summary</li>
                        <li><strong>Monthly:</strong> Comprehensive performance report</li>
                        <li><strong>Quarterly:</strong> Stakeholder satisfaction survey</li>
                    </ul>
                    
                    <h4>🎯 Success Criteria for Transition Completion</h4>
                    <ol>
                        <li>All critical tasks assigned and being executed successfully</li>
                        <li>Team performance metrics stable for 4 consecutive weeks</li>
                        <li>Stakeholder satisfaction maintained at pre-transition levels</li>
                        <li>No operational disruptions or quality degradation</li>
                        <li>Team confidence levels >80% across all roles</li>
                    </ol>
                    
                    <h4>🔄 Continuous Improvement Process</h4>
                    <ul>
                        <li><strong>Monthly Review:</strong> Analyze trends and identify improvement opportunities</li>
                        <li><strong>Quarterly Assessment:</strong> Comprehensive evaluation and metric refinement</li>
                        <li><strong>Annual Planning:</strong> Strategic review and goal setting for next period</li>
                    </ul>
                `);
            }

            customTemplate() {
                this.showTemplateModal('Custom Template Builder', `
                    <h3>✏️ Custom Template Builder</h3>
                    <p>Create custom documents and templates for your specific needs.</p>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h4>📋 Quick Templates</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <button class="btn btn-secondary" onclick="taskManager.generateCustomTemplate('meeting-notes')">Meeting Notes Template</button>
                            <button class="btn btn-secondary" onclick="taskManager.generateCustomTemplate('status-report')">Status Report Template</button>
                            <button class="btn btn-secondary" onclick="taskManager.generateCustomTemplate('incident-report')">Incident Report Template</button>
                            <button class="btn btn-secondary" onclick="taskManager.generateCustomTemplate('training-record')">Training Record Template</button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h4>📝 Custom Document Generator</h4>
                        <div class="form-group">
                            <label for="templateTitle">Document Title:</label>
                            <input type="text" id="templateTitle" placeholder="Enter document title...">
                        </div>
                        <div class="form-group">
                            <label for="templateType">Document Type:</label>
                            <select id="templateType">
                                <option value="report">Report</option>
                                <option value="checklist">Checklist</option>
                                <option value="procedure">Procedure</option>
                                <option value="communication">Communication</option>
                                <option value="form">Form</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="templateContent">Content Outline:</label>
                            <textarea id="templateContent" rows="6" placeholder="Enter main sections and content points..."></textarea>
                        </div>
                        <button class="btn" onclick="taskManager.generateCustomDocument()">Generate Custom Document</button>
                    </div>
                    
                    <div style="background: var(--fwi-light); padding: 1rem; border-radius: 8px;">
                        <h5>💡 Template Suggestions</h5>
                        <ul>
                            <li><strong>Equipment Logs:</strong> Daily/weekly equipment usage and maintenance records</li>
                            <li><strong>Farmer Visit Reports:</strong> Structured format for documenting farmer interactions</li>
                            <li><strong>Quality Control Checklists:</strong> Step-by-step verification procedures</li>
                            <li><strong>Emergency Response Plans:</strong> Quick-reference guides for crisis situations</li>
                            <li><strong>Training Evaluation Forms:</strong> Assess training effectiveness and knowledge retention</li>
                        </ul>
                    </div>
                `);
            }

            generateCustomTemplate(templateType) {
                let content = '';
                switch(templateType) {
                    case 'meeting-notes':
                        content = `
                            <h3>📝 Meeting Notes Template</h3>
                            <div style="font-family: monospace; background: #f8fafc; padding: 1rem; border-radius: 8px;">
                                <strong>Meeting Notes - [Meeting Title]</strong><br><br>
                                <strong>Date:</strong> [Date]<br>
                                <strong>Time:</strong> [Start Time] - [End Time]<br>
                                <strong>Location/Platform:</strong> [Location or Video Conference Link]<br>
                                <strong>Meeting Lead:</strong> [Name]<br>
                                <strong>Note Taker:</strong> [Name]<br><br>
                                
                                <strong>Attendees:</strong><br>
                                • [Name] - [Role]<br>
                                • [Name] - [Role]<br>
                                • [Name] - [Role]<br><br>
                                
                                <strong>Agenda Items:</strong><br>
                                1. [Agenda Item 1]<br>
                                2. [Agenda Item 2]<br>
                                3. [Agenda Item 3]<br><br>
                                
                                <strong>Discussion Summary:</strong><br>
                                [Main discussion points and key insights]<br><br>
                                
                                <strong>Decisions Made:</strong><br>
                                • [Decision 1]<br>
                                • [Decision 2]<br><br>
                                
                                <strong>Action Items:</strong><br>
                                • [Action] - Assigned to: [Name] - Due: [Date]<br>
                                • [Action] - Assigned to: [Name] - Due: [Date]<br><br>
                                
                                <strong>Next Meeting:</strong><br>
                                Date: [Date]<br>
                                Focus: [Next meeting focus]<br><br>
                                
                                <strong>Notes:</strong><br>
                                [Additional notes or follow-up items]
                            </div>
                        `;
                        break;
                    case 'status-report':
                        content = `
                            <h3>📊 Status Report Template</h3>
                            <div style="font-family: monospace; background: #f8fafc; padding: 1rem; border-radius: 8px;">
                                <strong>Weekly Status Report - [Period]</strong><br><br>
                                <strong>Reporting Period:</strong> [Start Date] - [End Date]<br>
                                <strong>Report Date:</strong> [Date]<br>
                                <strong>Prepared by:</strong> [Name]<br><br>
                                
                                <strong>SUMMARY</strong><br>
                                Overall Status: [Green/Yellow/Red]<br>
                                Key Achievements: [Brief summary]<br>
                                Major Challenges: [Brief summary]<br><br>
                                
                                <strong>TASK PROGRESS</strong><br>
                                • Completed Tasks: [Number]<br>
                                • In Progress: [Number]<br>
                                • Overdue: [Number]<br>
                                • Upcoming Deadlines: [Number]<br><br>
                                
                                <strong>KEY ACCOMPLISHMENTS</strong><br>
                                1. [Accomplishment 1]<br>
                                2. [Accomplishment 2]<br>
                                3. [Accomplishment 3]<br><br>
                                
                                <strong>CHALLENGES & ISSUES</strong><br>
                                1. [Challenge 1] - Status: [Resolution approach]<br>
                                2. [Challenge 2] - Status: [Resolution approach]<br><br>
                                
                                <strong>UPCOMING WEEK PRIORITIES</strong><br>
                                1. [Priority 1]<br>
                                2. [Priority 2]<br>
                                3. [Priority 3]<br><br>
                                
                                <strong>SUPPORT NEEDED</strong><br>
                                • [Support request 1]<br>
                                • [Support request 2]<br><br>
                                
                                <strong>METRICS</strong><br>
                                • Quality Score: [Score/Rating]<br>
                                • Team Utilization: [Percentage]<br>
                                • Stakeholder Satisfaction: [Rating]<br><br>
                                
                                <strong>NEXT PERIOD OUTLOOK</strong><br>
                                [Brief outlook for next reporting period]
                            </div>
                        `;
                        break;
                    case 'incident-report':
                        content = `
                            <h3>🚨 Incident Report Template</h3>
                            <div style="font-family: monospace; background: #f8fafc; padding: 1rem; border-radius: 8px;">
                                <strong>INCIDENT REPORT</strong><br><br>
                                <strong>Incident ID:</strong> [Auto-generated or assigned]<br>
                                <strong>Date of Incident:</strong> [Date]<br>
                                <strong>Time of Incident:</strong> [Time]<br>
                                <strong>Reported by:</strong> [Name and Role]<br>
                                <strong>Report Date:</strong> [Date]<br><br>
                                
                                <strong>INCIDENT DETAILS</strong><br>
                                <strong>Type:</strong> [Equipment/Process/Safety/Quality/Other]<br>
                                <strong>Severity Level:</strong> [Low/Medium/High/Critical]<br>
                                <strong>Location:</strong> [Specific location]<br>
                                <strong>Personnel Involved:</strong> [Names and roles]<br><br>
                                
                                <strong>DESCRIPTION</strong><br>
                                [Detailed description of what happened]<br><br>
                                
                                <strong>IMMEDIATE IMPACT</strong><br>
                                • Operations: [Impact on operations]<br>
                                • Personnel: [Any injuries or safety concerns]<br>
                                • Equipment: [Equipment damage or malfunction]<br>
                                • Data/Quality: [Impact on data quality or research]<br><br>
                                
                                <strong>IMMEDIATE ACTIONS TAKEN</strong><br>
                                1. [Action 1] - Time: [Time] - By: [Name]<br>
                                2. [Action 2] - Time: [Time] - By: [Name]<br>
                                3. [Action 3] - Time: [Time] - By: [Name]<br><br>
                                
                                <strong>ROOT CAUSE ANALYSIS</strong><br>
                                <strong>Contributing Factors:</strong><br>
                                • [Factor 1]<br>
                                • [Factor 2]<br>
                                <strong>Root Cause:</strong> [Primary root cause]<br><br>
                                
                                <strong>CORRECTIVE ACTIONS</strong><br>
                                1. [Action] - Responsible: [Name] - Due: [Date]<br>
                                2. [Action] - Responsible: [Name] - Due: [Date]<br><br>
                                
                                <strong>PREVENTIVE MEASURES</strong><br>
                                • [Measure 1]<br>
                                • [Measure 2]<br><br>
                                
                                <strong>FOLLOW-UP REQUIRED</strong><br>
                                • [Follow-up action] - Due: [Date]<br><br>
                                
                                <strong>LESSONS LEARNED</strong><br>
                                [Key takeaways and improvements for future]<br><br>
                                
                                <strong>APPROVALS</strong><br>
                                Prepared by: [Name] - Date: [Date]<br>
                                Reviewed by: [Manager Name] - Date: [Date]<br>
                                Approved by: [Senior Manager] - Date: [Date]
                            </div>
                        `;
                        break;
                    case 'training-record':
                        content = `
                            <h3>🎓 Training Record Template</h3>
                            <div style="font-family: monospace; background: #f8fafc; padding: 1rem; border-radius: 8px;">
                                <strong>TRAINING RECORD</strong><br><br>
                                <strong>Training ID:</strong> [Training identifier]<br>
                                <strong>Training Title:</strong> [Title of training program]<br>
                                <strong>Training Date:</strong> [Date]<br>
                                <strong>Duration:</strong> [Hours/Days]<br>
                                <strong>Trainer:</strong> [Trainer name and credentials]<br><br>
                                
                                <strong>PARTICIPANT INFORMATION</strong><br>
                                <strong>Name:</strong> [Participant name]<br>
                                <strong>Position:</strong> [Job title]<br>
                                <strong>Department:</strong> [Department]<br>
                                <strong>Employee ID:</strong> [ID number]<br><br>
                                
                                <strong>TRAINING OBJECTIVES</strong><br>
                                1. [Objective 1]<br>
                                2. [Objective 2]<br>
                                3. [Objective 3]<br><br>
                                
                                <strong>TRAINING CONTENT COVERED</strong><br>
                                • Module 1: [Module name] - [Duration]<br>
                                • Module 2: [Module name] - [Duration]<br>
                                • Module 3: [Module name] - [Duration]<br>
                                • Practical Exercise: [Description] - [Duration]<br><br>
                                
                                <strong>ASSESSMENT RESULTS</strong><br>
                                <strong>Written Test:</strong> [Score/Grade] - Pass/Fail<br>
                                <strong>Practical Assessment:</strong> [Score/Grade] - Pass/Fail<br>
                                <strong>Overall Result:</strong> [Pass/Fail]<br><br>
                                
                                <strong>COMPETENCIES ACHIEVED</strong><br>
                                ✓ [Competency 1]<br>
                                ✓ [Competency 2]<br>
                                ✓ [Competency 3]<br><br>
                                
                                <strong>AREAS FOR IMPROVEMENT</strong><br>
                                • [Area 1]<br>
                                • [Area 2]<br><br>
                                
                                <strong>ADDITIONAL TRAINING RECOMMENDED</strong><br>
                                • [Recommendation 1] - Timeline: [Timeline]<br>
                                • [Recommendation 2] - Timeline: [Timeline]<br><br>
                                
                                <strong>PARTICIPANT FEEDBACK</strong><br>
                                <strong>Training Quality (1-5):</strong> [Rating]<br>
                                <strong>Trainer Effectiveness (1-5):</strong> [Rating]<br>
                                <strong>Relevance to Job (1-5):</strong> [Rating]<br>
                                <strong>Comments:</strong> [Participant comments]<br><br>
                                
                                <strong>CERTIFICATION</strong><br>
                                <strong>Certificate Issued:</strong> Yes/No<br>
                                <strong>Certificate Number:</strong> [Number]<br>
                                <strong>Valid Until:</strong> [Date]<br>
                                <strong>Renewal Requirements:</strong> [Requirements]<br><br>
                                
                                <strong>SIGNATURES</strong><br>
                                Participant: [Signature] - Date: [Date]<br>
                                Trainer: [Signature] - Date: [Date]<br>
                                Supervisor: [Signature] - Date: [Date]
                            </div>
                        `;
                        break;
                }
                
                this.showTemplateModal('Custom Template: ' + templateType.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase()), content);
            }

            generateCustomDocument() {
                const title = document.getElementById('templateTitle').value || 'Custom Document';
                const type = document.getElementById('templateType').value;
                const contentOutline = document.getElementById('templateContent').value || 'Document content to be added';
                
                const content = `
                    <h3>📄 ${title}</h3>
                    <p><strong>Document Type:</strong> ${type.charAt(0).toUpperCase() + type.slice(1)}</p>
                    <p><strong>Generated:</strong> ${new Date().toLocaleDateString()}</p>
                    
                    <div style="font-family: monospace; background: #f8fafc; padding: 1rem; border-radius: 8px;">
                        <strong>${title.toUpperCase()}</strong><br><br>
                        
                        <strong>Document Information:</strong><br>
                        Version: 1.0<br>
                        Effective Date: ${new Date().toLocaleDateString()}<br>
                        Review Date: ${new Date(Date.now() + 90*24*60*60*1000).toLocaleDateString()}<br>
                        Owner: [Document Owner]<br><br>
                        
                        <strong>Purpose:</strong><br>
                        [Purpose and scope of this document]<br><br>
                        
                        <strong>Content Outline:</strong><br>
                        ${contentOutline.split('\n').map(line => line.trim() ? `${line}<br>` : '<br>').join('')}
                        
                        <br><strong>Additional Sections to Consider:</strong><br>
                        ${type === 'report' ? '• Executive Summary<br>• Methodology<br>• Findings<br>• Recommendations<br>• Appendices<br>' : ''}
                        ${type === 'checklist' ? '• Prerequisites<br>• Step-by-step items<br>• Verification criteria<br>• Sign-off requirements<br>' : ''}
                        ${type === 'procedure' ? '• Scope and Applicability<br>• Responsibilities<br>• Step-by-step Process<br>• Quality Controls<br>• Records<br>' : ''}
                        ${type === 'communication' ? '• Target Audience<br>• Key Messages<br>• Distribution Method<br>• Feedback Mechanism<br>' : ''}
                        ${type === 'form' ? '• Instructions<br>• Required Fields<br>• Approval Process<br>• Record Keeping<br>' : ''}
                        
                        <br><strong>Approval:</strong><br>
                        Prepared by: [Name] - Date: [Date]<br>
                        Reviewed by: [Name] - Date: [Date]<br>
                        Approved by: [Name] - Date: [Date]<br>
                    </div>
                `;
                
                this.showTemplateModal(title, content);
            }

            showDetailedAnalysis() {
                const content = `
                    <div style="font-family: Inter, sans-serif; line-height: 1.6;">
                        <h3>📊 Detailed Organizational Options Analysis</h3>
                        
                        ${this.organizationalOptions.map(option => `
                            <div style="margin-bottom: 2rem; padding: 1.5rem; border: 2px solid #e2e8f0; border-radius: 12px;">
                                <h4 style="color: var(--fwi-dark); margin-bottom: 1rem;">${option.name}</h4>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <h5 style="color: var(--success); margin-bottom: 0.5rem;">✅ Advantages:</h5>
                                        <ul>
                                            ${option.pros.map(pro => `<li>${pro}</li>`).join('')}
                                        </ul>
                                    </div>
                                    
                                    <div>
                                        <h5 style="color: var(--danger); margin-bottom: 0.5rem;">❌ Disadvantages:</h5>
                                        <ul>
                                            ${option.cons.map(con => `<li>${con}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                                
                                <div style="background: #fef2f2; padding: 1rem; border-radius: 8px;">
                                    <h5 style="color: var(--danger); margin-bottom: 0.5rem;">⚠️ Risk Factors:</h5>
                                    <ul>
                                        ${option.riskFactors.map(risk => `<li>${risk}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                document.getElementById('recommendationsContent').innerHTML = content;
                document.getElementById('recommendationsModal').style.display = 'block';
            }

            updateProgress() {
                this.updateHandoverProgress();
            }
        }

        // Global Functions
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab and mark button as active
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showTaskAssignmentModal(taskId) {
            const task = taskManager.getAllTasks().find(t => t.id === taskId);
            if (!task) return;
            
            const currentAssignment = taskManager.positions.find(p => p.selectedTasks.includes(taskId));
            
            const content = `
                <div>
                    <h3>${task.title}</h3>
                    <p style="margin: 1rem 0; color: var(--neutral);">${task.description}</p>
                    
                    <div style="margin-bottom: 1rem;">
                        <strong>Due:</strong> ${new Date(task.dueDate).toLocaleDateString()} 
                        <strong>Priority:</strong> ${task.priority} 
                        <strong>Complexity:</strong> ${task.complexity}
                    </div>
                    
                    <h4>Assign to:</h4>
                    <div style="margin: 1rem 0;">
                        <button class="btn btn-secondary" onclick="taskManager.toggleTaskAssignment('${taskId}', null); closeModal('recommendationsModal'); taskManager.renderAll();">
                            Unassign Task
                        </button>
                    </div>
                    
                    ${taskManager.positions.map(position => `
                        <div style="margin: 0.5rem 0; padding: 0.75rem; border: 2px solid ${currentAssignment && currentAssignment.id === position.id ? 'var(--fwi-primary)' : '#e2e8f0'}; border-radius: 8px; cursor: pointer;" onclick="taskManager.toggleTaskAssignment('${taskId}', '${position.id}'); closeModal('recommendationsModal'); taskManager.renderAll();">
                            <strong>${position.title}</strong><br>
                            <span style="color: var(--neutral); font-size: 0.9rem;">
                                Current workload: ${Math.round(taskManager.calculateWorkload(position))}%
                            </span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('recommendationsContent').innerHTML = content;
            document.getElementById('recommendationsModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function exportToPDF() { taskManager.exportToPDF(); }
        function exportToCSV() { taskManager.exportToCSV(); }
        function previewExport() { taskManager.previewExport(); }
        function generateAgenda() { taskManager.generateAgenda(); }
        function generateEmails() { taskManager.generateEmails(); }
        function generateAnnouncement() { taskManager.generateAnnouncement(); }
        function generateSlackUpdate() { taskManager.generateSlackUpdate(); }
        function showHandoverChecklist() { taskManager.showHandoverChecklist(); }
        function generateKnowledgeTransfer() { taskManager.generateKnowledgeTransfer(); }
        function createTransitionPlan() { taskManager.createTransitionPlan(); }
        function generateSOPs() { taskManager.generateSOPs(); }
        function updateProgress() { taskManager.updateProgress(); }
        function generateProgressReport() { taskManager.generateProgressReport(); }
        function generateRiskAssessment() { taskManager.generateRiskAssessment(); }
        function createContingencyPlan() { taskManager.createContingencyPlan(); }
        function scheduleCheckIns() { taskManager.scheduleCheckIns(); }
        function generateJobDescription() { taskManager.generateJobDescription(); }
        function generateTrainingPlan() { taskManager.generateTrainingPlan(); }
        function generatePerformanceMetrics() { taskManager.generatePerformanceMetrics(); }
        function customTemplate() { taskManager.customTemplate(); }
        function analyzeRisks() { taskManager.analyzeRisks(); }
        function updateDecisionMatrix() { taskManager.updateDecisionMatrix(); }
        function showDetailedAnalysis() { taskManager.showDetailedAnalysis(); }

        // Add these new global functions for the TaskManager methods
        window.taskManager = taskManager; // Make taskManager globally accessible for the custom template functions

        // Initialize
        const taskManager = new TaskManager();

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>
